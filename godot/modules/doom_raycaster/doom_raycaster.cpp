#include "doom_raycaster.h"
#include "core/os/keyboard.h"
#include "core/math/math_funcs.h"

static const int RENDER_WIDTH = 1152;
static const int RENDER_HEIGHT = 648;
static const float SCALE = 0.20f;

// these tables allow us to do lookups for all trig math, instead of computations
static const float RAY_COS[RENDER_WIDTH] = {
0.866025404f,0.866401201f,0.866776834f,0.867152300f,0.867527599f,0.867902729f,0.868277688f,0.868652475f,0.869027088f,0.869401527f,0.869775788f,0.870149872f,0.870523775f,0.870897498f,0.871271038f,0.871644393f,0.872017563f,0.872390545f,0.872763338f,0.873135941f,0.873508352f,0.873880569f,0.874252591f,0.874624417f,0.874996044f,0.875367472f,0.875738698f,0.876109721f,0.876480539f,0.876851152f,0.877221557f,0.877591752f,0.877961737f,0.878331510f,0.878701068f,0.879070410f,0.879439536f,0.879808442f,0.880177129f,0.880545593f,0.880913833f,0.881281848f,0.881649636f,0.882017196f,0.882384525f,0.882751623f,0.883118487f,0.883485117f,0.883851509f,0.884217663f,0.884583577f,0.884949250f,0.885314679f,0.885679863f,0.886044801f,0.886409491f,0.886773930f,0.887138118f,0.887502053f,0.887865733f,0.888229156f,0.888592321f,0.888955225f,0.889317869f,0.889680249f,0.890042363f,0.890404212f,0.890765791f,0.891127101f,0.891488139f,0.891848903f,0.892209392f,0.892569604f,0.892929537f,0.893289190f,0.893648561f,0.894007649f,0.894366450f,0.894724964f,0.895083190f,0.895441124f,0.895798766f,0.896156114f,0.896513166f,0.896869921f,0.897226376f,0.897582529f,0.897938380f,0.898293926f,0.898649166f,0.899004097f,0.899358718f,0.899713028f,0.900067024f,0.900420705f,0.900774069f,0.901127114f,0.901479838f,0.901832240f,0.902184318f,0.902536070f,0.902887494f,0.903238589f,0.903589352f,0.903939782f,0.904289877f,0.904639636f,0.904989056f,0.905338136f,0.905686873f,0.906035267f,0.906383315f,0.906731015f,0.907078366f,0.907425366f,0.907772012f,0.908118304f,0.908464239f,0.908809816f,0.909155032f,0.909499886f,0.909844376f,0.910188501f,0.910532257f,0.910875644f,0.911218660f,0.911561303f,0.911903570f,0.912245461f,0.912586973f,0.912928104f,0.913268853f,0.913609217f,0.913949195f,0.914288786f,0.914627986f,0.914966795f,0.915305210f,0.915643229f,0.915980851f,0.916318074f,0.916654896f,0.916991314f,0.917327328f,0.917662935f,0.917998134f,0.918332922f,0.918667298f,0.919001259f,0.919334804f,0.919667931f,0.920000638f,0.920332923f,0.920664785f,0.920996221f,0.921327229f,0.921657808f,0.921987956f,0.922317670f,0.922646949f,0.922975792f,0.923304195f,0.923632157f,0.923959677f,0.924286752f,0.924613380f,0.924939560f,0.925265290f,0.925590567f,0.925915390f,0.926239757f,0.926563666f,0.926887114f,0.927210101f,0.927532624f,0.927854681f,0.928176271f,0.928497391f,0.928818039f,0.929138214f,0.929457914f,0.929777136f,0.930095879f,0.930414141f,0.930731920f,0.931049213f,0.931366020f,0.931682338f,0.931998165f,0.932313499f,0.932628338f,0.932942681f,0.933256525f,0.933569869f,0.933882710f,0.934195047f,0.934506877f,0.934818200f,0.935129011f,0.935439311f,0.935749097f,0.936058367f,0.936367118f,0.936675350f,0.936983060f,0.937290246f,0.937596906f,0.937903038f,0.938208641f,0.938513712f,0.938818250f,0.939122252f,0.939425717f,0.939728642f,0.940031026f,0.940332867f,0.940634162f,0.940934910f,0.941235109f,0.941534758f,0.941833853f,0.942132393f,0.942430376f,0.942727800f,0.943024664f,0.943320965f,0.943616701f,0.943911871f,0.944206472f,0.944500502f,0.944793960f,0.945086844f,0.945379151f,0.945670880f,0.945962029f,0.946252595f,0.946542578f,0.946831974f,0.947120783f,0.947409001f,0.947696628f,0.947983661f,0.948270098f,0.948555937f,0.948841177f,0.949125815f,0.949409850f,0.949693279f,0.949976101f,0.950258314f,0.950539916f,0.950820904f,0.951101277f,0.951381034f,0.951660171f,0.951938688f,0.952216581f,0.952493851f,0.952770493f,0.953046507f,0.953321891f,0.953596642f,0.953870759f,0.954144239f,0.954417082f,0.954689284f,0.954960845f,0.955231762f,0.955502033f,0.955771656f,0.956040630f,0.956308952f,0.956576621f,0.956843635f,0.957109992f,0.957375689f,0.957640726f,0.957905099f,0.958168808f,0.958431851f,0.958694225f,0.958955928f,0.959216959f,0.959477316f,0.959736997f,0.959996000f,0.960254323f,0.960511965f,0.960768923f,0.961025195f,0.961280781f,0.961535677f,0.961789882f,0.962043395f,0.962296212f,0.962548333f,0.962799756f,0.963050478f,0.963300499f,0.963549815f,0.963798425f,0.964046328f,0.964293522f,0.964540004f,0.964785773f,0.965030827f,0.965275164f,0.965518782f,0.965761680f,0.966003856f,0.966245308f,0.966486034f,0.966726032f,0.966965301f,0.967203838f,0.967441642f,0.967678712f,0.967915045f,0.968150639f,0.968385493f,0.968619605f,0.968852973f,0.969085595f,0.969317470f,0.969548596f,0.969778971f,0.970008593f,0.970237461f,0.970465573f,0.970692926f,0.970919520f,0.971145353f,0.971370422f,0.971594726f,0.971818264f,0.972041034f,0.972263033f,0.972484260f,0.972704714f,0.972924392f,0.973143294f,0.973361417f,0.973578759f,0.973795319f,0.974011096f,0.974226087f,0.974440291f,0.974653706f,0.974866330f,0.975078162f,0.975289200f,0.975499443f,0.975708889f,0.975917535f,0.976125381f,0.976332425f,0.976538665f,0.976744100f,0.976948728f,0.977152546f,0.977355555f,0.977557751f,0.977759134f,0.977959702f,0.978159453f,0.978358385f,0.978556498f,0.978753788f,0.978950256f,0.979145899f,0.979340715f,0.979534704f,0.979727863f,0.979920191f,0.980111686f,0.980302347f,0.980492173f,0.980681161f,0.980869310f,0.981056619f,0.981243086f,0.981428710f,0.981613489f,0.981797422f,0.981980506f,0.982162741f,0.982344125f,0.982524657f,0.982704335f,0.982883158f,0.983061123f,0.983238231f,0.983414478f,0.983589864f,0.983764388f,0.983938048f,0.984110842f,0.984282769f,0.984453827f,0.984624016f,0.984793333f,0.984961778f,0.985129349f,0.985296044f,0.985461863f,0.985626803f,0.985790863f,0.985954043f,0.986116340f,0.986277753f,0.986438282f,0.986597924f,0.986756678f,0.986914543f,0.987071518f,0.987227600f,0.987382790f,0.987537086f,0.987690485f,0.987842988f,0.987994592f,0.988145297f,0.988295101f,0.988444003f,0.988592002f,0.988739096f,0.988885283f,0.989030564f,0.989174937f,0.989318400f,0.989460952f,0.989602592f,0.989743319f,0.989883131f,0.990022028f,0.990160007f,0.990297069f,0.990433212f,0.990568434f,0.990702735f,0.990836113f,0.990968567f,0.991100096f,0.991230699f,0.991360375f,0.991489123f,0.991616941f,0.991743828f,0.991869784f,0.991994807f,0.992118896f,0.992242050f,0.992364269f,0.992485550f,0.992605893f,0.992725297f,0.992843761f,0.992961284f,0.993077864f,0.993193501f,0.993308194f,0.993421942f,0.993534743f,0.993646597f,0.993757503f,0.993867460f,0.993976467f,0.994084522f,0.994191626f,0.994297776f,0.994402973f,0.994507214f,0.994610501f,0.994712830f,0.994814202f,0.994914615f,0.995014069f,0.995112563f,0.995210096f,0.995306666f,0.995402274f,0.995496919f,0.995590599f,0.995683314f,0.995775062f,0.995865844f,0.995955658f,0.996044503f,0.996132379f,0.996219285f,0.996305220f,0.996390184f,0.996474175f,0.996557193f,0.996639237f,0.996720307f,0.996800401f,0.996879520f,0.996957661f,0.997034826f,0.997111012f,0.997186219f,0.997260447f,0.997333695f,0.997405962f,0.997477248f,0.997547551f,0.997616872f,0.997685210f,0.997752564f,0.997818933f,0.997884317f,0.997948716f,0.998012128f,0.998074554f,0.998135992f,0.998196442f,0.998255904f,0.998314376f,0.998371860f,0.998428353f,0.998483855f,0.998538367f,0.998591887f,0.998644415f,0.998695951f,0.998746493f,0.998796043f,0.998844598f,0.998892159f,0.998938726f,0.998984297f,0.999028873f,0.999072453f,0.999115036f,0.999156623f,0.999197213f,0.999236805f,0.999275399f,0.999312996f,0.999349593f,0.999385192f,0.999419792f,0.999453393f,0.999485993f,0.999517594f,0.999548194f,0.999577794f,0.999606392f,0.999633990f,0.999660586f,0.999686181f,0.999710774f,0.999734364f,0.999756953f,0.999778539f,0.999799122f,0.999818702f,0.999837279f,0.999854853f,0.999871424f,0.999886991f,0.999901555f,0.999915114f,0.999927670f,0.999939222f,0.999949769f,0.999959312f,0.999967851f,0.999975386f,0.999981916f,0.999987442f,0.999991963f,0.999995479f,0.999997991f,0.999999498f,1.000000000f,0.999999498f,0.999997991f,0.999995479f,0.999991963f,0.999987442f,0.999981916f,0.999975386f,0.999967851f,0.999959312f,0.999949769f,0.999939222f,0.999927670f,0.999915114f,0.999901555f,0.999886991f,0.999871424f,0.999854853f,0.999837279f,0.999818702f,0.999799122f,0.999778539f,0.999756953f,0.999734364f,0.999710774f,0.999686181f,0.999660586f,0.999633990f,0.999606392f,0.999577794f,0.999548194f,0.999517594f,0.999485993f,0.999453393f,0.999419792f,0.999385192f,0.999349593f,0.999312996f,0.999275399f,0.999236805f,0.999197213f,0.999156623f,0.999115036f,0.999072453f,0.999028873f,0.998984297f,0.998938726f,0.998892159f,0.998844598f,0.998796043f,0.998746493f,0.998695951f,0.998644415f,0.998591887f,0.998538367f,0.998483855f,0.998428353f,0.998371860f,0.998314376f,0.998255904f,0.998196442f,0.998135992f,0.998074554f,0.998012128f,0.997948716f,0.997884317f,0.997818933f,0.997752564f,0.997685210f,0.997616872f,0.997547551f,0.997477248f,0.997405962f,0.997333695f,0.997260447f,0.997186219f,0.997111012f,0.997034826f,0.996957661f,0.996879520f,0.996800401f,0.996720307f,0.996639237f,0.996557193f,0.996474175f,0.996390184f,0.996305220f,0.996219285f,0.996132379f,0.996044503f,0.995955658f,0.995865844f,0.995775062f,0.995683314f,0.995590599f,0.995496919f,0.995402274f,0.995306666f,0.995210096f,0.995112563f,0.995014069f,0.994914615f,0.994814202f,0.994712830f,0.994610501f,0.994507214f,0.994402973f,0.994297776f,0.994191626f,0.994084522f,0.993976467f,0.993867460f,0.993757503f,0.993646597f,0.993534743f,0.993421942f,0.993308194f,0.993193501f,0.993077864f,0.992961284f,0.992843761f,0.992725297f,0.992605893f,0.992485550f,0.992364269f,0.992242050f,0.992118896f,0.991994807f,0.991869784f,0.991743828f,0.991616941f,0.991489123f,0.991360375f,0.991230699f,0.991100096f,0.990968567f,0.990836113f,0.990702735f,0.990568434f,0.990433212f,0.990297069f,0.990160007f,0.990022028f,0.989883131f,0.989743319f,0.989602592f,0.989460952f,0.989318400f,0.989174937f,0.989030564f,0.988885283f,0.988739096f,0.988592002f,0.988444003f,0.988295101f,0.988145297f,0.987994592f,0.987842988f,0.987690485f,0.987537086f,0.987382790f,0.987227600f,0.987071518f,0.986914543f,0.986756678f,0.986597924f,0.986438282f,0.986277753f,0.986116340f,0.985954043f,0.985790863f,0.985626803f,0.985461863f,0.985296044f,0.985129349f,0.984961778f,0.984793333f,0.984624016f,0.984453827f,0.984282769f,0.984110842f,0.983938048f,0.983764388f,0.983589864f,0.983414478f,0.983238231f,0.983061123f,0.982883158f,0.982704335f,0.982524657f,0.982344125f,0.982162741f,0.981980506f,0.981797422f,0.981613489f,0.981428710f,0.981243086f,0.981056619f,0.980869310f,0.980681161f,0.980492173f,0.980302347f,0.980111686f,0.979920191f,0.979727863f,0.979534704f,0.979340715f,0.979145899f,0.978950256f,0.978753788f,0.978556498f,0.978358385f,0.978159453f,0.977959702f,0.977759134f,0.977557751f,0.977355555f,0.977152546f,0.976948728f,0.976744100f,0.976538665f,0.976332425f,0.976125381f,0.975917535f,0.975708889f,0.975499443f,0.975289200f,0.975078162f,0.974866330f,0.974653706f,0.974440291f,0.974226087f,0.974011096f,0.973795319f,0.973578759f,0.973361417f,0.973143294f,0.972924392f,0.972704714f,0.972484260f,0.972263033f,0.972041034f,0.971818264f,0.971594726f,0.971370422f,0.971145353f,0.970919520f,0.970692926f,0.970465573f,0.970237461f,0.970008593f,0.969778971f,0.969548596f,0.969317470f,0.969085595f,0.968852973f,0.968619605f,0.968385493f,0.968150639f,0.967915045f,0.967678712f,0.967441642f,0.967203838f,0.966965301f,0.966726032f,0.966486034f,0.966245308f,0.966003856f,0.965761680f,0.965518782f,0.965275164f,0.965030827f,0.964785773f,0.964540004f,0.964293522f,0.964046328f,0.963798425f,0.963549815f,0.963300499f,0.963050478f,0.962799756f,0.962548333f,0.962296212f,0.962043395f,0.961789882f,0.961535677f,0.961280781f,0.961025195f,0.960768923f,0.960511965f,0.960254323f,0.959996000f,0.959736997f,0.959477316f,0.959216959f,0.958955928f,0.958694225f,0.958431851f,0.958168808f,0.957905099f,0.957640726f,0.957375689f,0.957109992f,0.956843635f,0.956576621f,0.956308952f,0.956040630f,0.955771656f,0.955502033f,0.955231762f,0.954960845f,0.954689284f,0.954417082f,0.954144239f,0.953870759f,0.953596642f,0.953321891f,0.953046507f,0.952770493f,0.952493851f,0.952216581f,0.951938688f,0.951660171f,0.951381034f,0.951101277f,0.950820904f,0.950539916f,0.950258314f,0.949976101f,0.949693279f,0.949409850f,0.949125815f,0.948841177f,0.948555937f,0.948270098f,0.947983661f,0.947696628f,0.947409001f,0.947120783f,0.946831974f,0.946542578f,0.946252595f,0.945962029f,0.945670880f,0.945379151f,0.945086844f,0.944793960f,0.944500502f,0.944206472f,0.943911871f,0.943616701f,0.943320965f,0.943024664f,0.942727800f,0.942430376f,0.942132393f,0.941833853f,0.941534758f,0.941235109f,0.940934910f,0.940634162f,0.940332867f,0.940031026f,0.939728642f,0.939425717f,0.939122252f,0.938818250f,0.938513712f,0.938208641f,0.937903038f,0.937596906f,0.937290246f,0.936983060f,0.936675350f,0.936367118f,0.936058367f,0.935749097f,0.935439311f,0.935129011f,0.934818200f,0.934506877f,0.934195047f,0.933882710f,0.933569869f,0.933256525f,0.932942681f,0.932628338f,0.932313499f,0.931998165f,0.931682338f,0.931366020f,0.931049213f,0.930731920f,0.930414141f,0.930095879f,0.929777136f,0.929457914f,0.929138214f,0.928818039f,0.928497391f,0.928176271f,0.927854681f,0.927532624f,0.927210101f,0.926887114f,0.926563666f,0.926239757f,0.925915390f,0.925590567f,0.925265290f,0.924939560f,0.924613380f,0.924286752f,0.923959677f,0.923632157f,0.923304195f,0.922975792f,0.922646949f,0.922317670f,0.921987956f,0.921657808f,0.921327229f,0.920996221f,0.920664785f,0.920332923f,0.920000638f,0.919667931f,0.919334804f,0.919001259f,0.918667298f,0.918332922f,0.917998134f,0.917662935f,0.917327328f,0.916991314f,0.916654896f,0.916318074f,0.915980851f,0.915643229f,0.915305210f,0.914966795f,0.914627986f,0.914288786f,0.913949195f,0.913609217f,0.913268853f,0.912928104f,0.912586973f,0.912245461f,0.911903570f,0.911561303f,0.911218660f,0.910875644f,0.910532257f,0.910188501f,0.909844376f,0.909499886f,0.909155032f,0.908809816f,0.908464239f,0.908118304f,0.907772012f,0.907425366f,0.907078366f,0.906731015f,0.906383315f,0.906035267f,0.905686873f,0.905338136f,0.904989056f,0.904639636f,0.904289877f,0.903939782f,0.903589352f,0.903238589f,0.902887494f,0.902536070f,0.902184318f,0.901832240f,0.901479838f,0.901127114f,0.900774069f,0.900420705f,0.900067024f,0.899713028f,0.899358718f,0.899004097f,0.898649166f,0.898293926f,0.897938380f,0.897582529f,0.897226376f,0.896869921f,0.896513166f,0.896156114f,0.895798766f,0.895441124f,0.895083190f,0.894724964f,0.894366450f,0.894007649f,0.893648561f,0.893289190f,0.892929537f,0.892569604f,0.892209392f,0.891848903f,0.891488139f,0.891127101f,0.890765791f,0.890404212f,0.890042363f,0.889680249f,0.889317869f,0.888955225f,0.888592321f,0.888229156f,0.887865733f,0.887502053f,0.887138118f,0.886773930f,0.886409491f,0.886044801f,0.885679863f,0.885314679f,0.884949250f,0.884583577f,0.884217663f,0.883851509f,0.883485117f,0.883118487f,0.882751623f,0.882384525f,0.882017196f,0.881649636f,0.881281848f,0.880913833f,0.880545593f,0.880177129f,0.879808442f,0.879439536f,0.879070410f,0.878701068f,0.878331510f,0.877961737f,0.877591752f,0.877221557f,0.876851152f,0.876480539f,0.876109721f,0.875738698f,0.875367472f,0.874996044f,0.874624417f,0.874252591f,0.873880569f,0.873508352f,0.873135941f,0.872763338f,0.872390545f,0.872017563f,0.871644393f,0.871271038f,0.870897498f,0.870523775f,0.870149872f,0.869775788f,0.869401527f,0.869027088f,0.868652475f,0.868277688f,0.867902729f,0.867527599f,0.867152300f,0.866776834f,0.866401201f,};

static const float RAY_SIN[RENDER_WIDTH] = {
-0.500000000f,-0.499348534f,-0.498696221f,-0.498043059f,-0.497389048f,-0.496734188f,-0.496078478f,-0.495421919f,-0.494764509f,-0.494106249f,-0.493447138f,-0.492787176f,-0.492126362f,-0.491464697f,-0.490802179f,-0.490138809f,-0.489474586f,-0.488809510f,-0.488143581f,-0.487476798f,-0.486809161f,-0.486140670f,-0.485471324f,-0.484801124f,-0.484130068f,-0.483458157f,-0.482785391f,-0.482111768f,-0.481437290f,-0.480761955f,-0.480085763f,-0.479408715f,-0.478730809f,-0.478052047f,-0.477372426f,-0.476691948f,-0.476010612f,-0.475328418f,-0.474645365f,-0.473961453f,-0.473276683f,-0.472591054f,-0.471904565f,-0.471217218f,-0.470529010f,-0.469839943f,-0.469150016f,-0.468459229f,-0.467767581f,-0.467075073f,-0.466381705f,-0.465687476f,-0.464992386f,-0.464296435f,-0.463599623f,-0.462901950f,-0.462203415f,-0.461504019f,-0.460803761f,-0.460102642f,-0.459400661f,-0.458697818f,-0.457994113f,-0.457289546f,-0.456584116f,-0.455877825f,-0.455170671f,-0.454462655f,-0.453753777f,-0.453044036f,-0.452333433f,-0.451621967f,-0.450909638f,-0.450196447f,-0.449482394f,-0.448767477f,-0.448051698f,-0.447335057f,-0.446617552f,-0.445899185f,-0.445179956f,-0.444459863f,-0.443738908f,-0.443017091f,-0.442294410f,-0.441570868f,-0.440846462f,-0.440121195f,-0.439395064f,-0.438668072f,-0.437940217f,-0.437211500f,-0.436481921f,-0.435751480f,-0.435020177f,-0.434288012f,-0.433554985f,-0.432821096f,-0.432086346f,-0.431350735f,-0.430614262f,-0.429876928f,-0.429138733f,-0.428399677f,-0.427659760f,-0.426918983f,-0.426177345f,-0.425434847f,-0.424691488f,-0.423947270f,-0.423202192f,-0.422456254f,-0.421709458f,-0.420961801f,-0.420213286f,-0.419463912f,-0.418713680f,-0.417962589f,-0.417210641f,-0.416457834f,-0.415704170f,-0.414949648f,-0.414194270f,-0.413438035f,-0.412680943f,-0.411922994f,-0.411164190f,-0.410404530f,-0.409644015f,-0.408882645f,-0.408120420f,-0.407357340f,-0.406593407f,-0.405828619f,-0.405062978f,-0.404296484f,-0.403529137f,-0.402760938f,-0.401991887f,-0.401221984f,-0.400451230f,-0.399679624f,-0.398907169f,-0.398133863f,-0.397359707f,-0.396584702f,-0.395808848f,-0.395032146f,-0.394254596f,-0.393476198f,-0.392696953f,-0.391916861f,-0.391135923f,-0.390354139f,-0.389571510f,-0.388788036f,-0.388003717f,-0.387218555f,-0.386432549f,-0.385645701f,-0.384858010f,-0.384069478f,-0.383280104f,-0.382489889f,-0.381698834f,-0.380906940f,-0.380114206f,-0.379320634f,-0.378526224f,-0.377730976f,-0.376934892f,-0.376137972f,-0.375340215f,-0.374541624f,-0.373742199f,-0.372941940f,-0.372140847f,-0.371338922f,-0.370536165f,-0.369732578f,-0.368928159f,-0.368122911f,-0.367316833f,-0.366509927f,-0.365702193f,-0.364893632f,-0.364084244f,-0.363274031f,-0.362462993f,-0.361651130f,-0.360838444f,-0.360024935f,-0.359210604f,-0.358395452f,-0.357579479f,-0.356762686f,-0.355945075f,-0.355126645f,-0.354307397f,-0.353487333f,-0.352666454f,-0.351844759f,-0.351022250f,-0.350198928f,-0.349374793f,-0.348549847f,-0.347724090f,-0.346897522f,-0.346070146f,-0.345241962f,-0.344412970f,-0.343583172f,-0.342752568f,-0.341921160f,-0.341088948f,-0.340255933f,-0.339422117f,-0.338587499f,-0.337752082f,-0.336915865f,-0.336078851f,-0.335241039f,-0.334402432f,-0.333563029f,-0.332722832f,-0.331881842f,-0.331040060f,-0.330197487f,-0.329354124f,-0.328509972f,-0.327665032f,-0.326819305f,-0.325972792f,-0.325125494f,-0.324277413f,-0.323428549f,-0.322578903f,-0.321728477f,-0.320877271f,-0.320025288f,-0.319172527f,-0.318318990f,-0.317464678f,-0.316609593f,-0.315753735f,-0.314897106f,-0.314039706f,-0.313181537f,-0.312322601f,-0.311462898f,-0.310602429f,-0.309741196f,-0.308879200f,-0.308016443f,-0.307152924f,-0.306288647f,-0.305423611f,-0.304557818f,-0.303691270f,-0.302823968f,-0.301955912f,-0.301087105f,-0.300217547f,-0.299347241f,-0.298476186f,-0.297604385f,-0.296731839f,-0.295858549f,-0.294984517f,-0.294109743f,-0.293234230f,-0.292357978f,-0.291480990f,-0.290603265f,-0.289724807f,-0.288845616f,-0.287965693f,-0.287085041f,-0.286203659f,-0.285321551f,-0.284438717f,-0.283555159f,-0.282670878f,-0.281785876f,-0.280900154f,-0.280013714f,-0.279126557f,-0.278238684f,-0.277350098f,-0.276460800f,-0.275570790f,-0.274680072f,-0.273788646f,-0.272896513f,-0.272003676f,-0.271110136f,-0.270215895f,-0.269320954f,-0.268425314f,-0.267528978f,-0.266631947f,-0.265734222f,-0.264835806f,-0.263936699f,-0.263036904f,-0.262136422f,-0.261235254f,-0.260333403f,-0.259430870f,-0.258527657f,-0.257623766f,-0.256719197f,-0.255813953f,-0.254908036f,-0.254001448f,-0.253094189f,-0.252186262f,-0.251277668f,-0.250368410f,-0.249458489f,-0.248547906f,-0.247636664f,-0.246724765f,-0.245812209f,-0.244899000f,-0.243985138f,-0.243070626f,-0.242155465f,-0.241239658f,-0.240323205f,-0.239406109f,-0.238488372f,-0.237569996f,-0.236650982f,-0.235731333f,-0.234811050f,-0.233890135f,-0.232968590f,-0.232046417f,-0.231123618f,-0.230200195f,-0.229276149f,-0.228351483f,-0.227426199f,-0.226500298f,-0.225573783f,-0.224646656f,-0.223718918f,-0.222790571f,-0.221861618f,-0.220932061f,-0.220001901f,-0.219071140f,-0.218139781f,-0.217207826f,-0.216275277f,-0.215342135f,-0.214408402f,-0.213474082f,-0.212539175f,-0.211603685f,-0.210667612f,-0.209730960f,-0.208793730f,-0.207855924f,-0.206917545f,-0.205978594f,-0.205039074f,-0.204098987f,-0.203158335f,-0.202217120f,-0.201275344f,-0.200333010f,-0.199390119f,-0.198446675f,-0.197502678f,-0.196558132f,-0.195613038f,-0.194667399f,-0.193721217f,-0.192774493f,-0.191827232f,-0.190879433f,-0.189931101f,-0.188982237f,-0.188032843f,-0.187082921f,-0.186132475f,-0.185181505f,-0.184230016f,-0.183278008f,-0.182325484f,-0.181372446f,-0.180418897f,-0.179464839f,-0.178510275f,-0.177555206f,-0.176599635f,-0.175643565f,-0.174686997f,-0.173729935f,-0.172772380f,-0.171814335f,-0.170855802f,-0.169896784f,-0.168937283f,-0.167977301f,-0.167016841f,-0.166055906f,-0.165094497f,-0.164132617f,-0.163170269f,-0.162207455f,-0.161244178f,-0.160280439f,-0.159316242f,-0.158351589f,-0.157386482f,-0.156420924f,-0.155454917f,-0.154488464f,-0.153521567f,-0.152554229f,-0.151586453f,-0.150618240f,-0.149649594f,-0.148680517f,-0.147711011f,-0.146741079f,-0.145770724f,-0.144799948f,-0.143828753f,-0.142857143f,-0.141885119f,-0.140912685f,-0.139939843f,-0.138966596f,-0.137992945f,-0.137018895f,-0.136044447f,-0.135069603f,-0.134094368f,-0.133118742f,-0.132142730f,-0.131166333f,-0.130189554f,-0.129212396f,-0.128234861f,-0.127256953f,-0.126278673f,-0.125300024f,-0.124321010f,-0.123341633f,-0.122361895f,-0.121381799f,-0.120401348f,-0.119420544f,-0.118439391f,-0.117457891f,-0.116476046f,-0.115493860f,-0.114511335f,-0.113528474f,-0.112545279f,-0.111561754f,-0.110577900f,-0.109593722f,-0.108609221f,-0.107624401f,-0.106639263f,-0.105653811f,-0.104668048f,-0.103681977f,-0.102695599f,-0.101708919f,-0.100721938f,-0.099734660f,-0.098747087f,-0.097759222f,-0.096771069f,-0.095782629f,-0.094793905f,-0.093804901f,-0.092815619f,-0.091826063f,-0.090836234f,-0.089846135f,-0.088855771f,-0.087865143f,-0.086874254f,-0.085883107f,-0.084891705f,-0.083900051f,-0.082908147f,-0.081915997f,-0.080923604f,-0.079930969f,-0.078938097f,-0.077944990f,-0.076951651f,-0.075958083f,-0.074964288f,-0.073970270f,-0.072976031f,-0.071981575f,-0.070986904f,-0.069992021f,-0.068996930f,-0.068001632f,-0.067006131f,-0.066010430f,-0.065014532f,-0.064018440f,-0.063022156f,-0.062025684f,-0.061029026f,-0.060032186f,-0.059035166f,-0.058037969f,-0.057040599f,-0.056043058f,-0.055045349f,-0.054047475f,-0.053049439f,-0.052051244f,-0.051052893f,-0.050054389f,-0.049055734f,-0.048056933f,-0.047057988f,-0.046058901f,-0.045059676f,-0.044060316f,-0.043060823f,-0.042061202f,-0.041061453f,-0.040061582f,-0.039061590f,-0.038061481f,-0.037061257f,-0.036060922f,-0.035060479f,-0.034059930f,-0.033059279f,-0.032058528f,-0.031057681f,-0.030056741f,-0.029055710f,-0.028054591f,-0.027053388f,-0.026052104f,-0.025050742f,-0.024049304f,-0.023047793f,-0.022046213f,-0.021044567f,-0.020042857f,-0.019041087f,-0.018039260f,-0.017037378f,-0.016035445f,-0.015033464f,-0.014031438f,-0.013029369f,-0.012027261f,-0.011025116f,-0.010022939f,-0.009020731f,-0.008018496f,-0.007016237f,-0.006013957f,-0.005011658f,-0.004009345f,-0.003007019f,-0.002004684f,-0.001002344f,0.000000000f,0.001002344f,0.002004684f,0.003007019f,0.004009345f,0.005011658f,0.006013957f,0.007016237f,0.008018496f,0.009020731f,0.010022939f,0.011025116f,0.012027261f,0.013029369f,0.014031438f,0.015033464f,0.016035445f,0.017037378f,0.018039260f,0.019041087f,0.020042857f,0.021044567f,0.022046213f,0.023047793f,0.024049304f,0.025050742f,0.026052104f,0.027053388f,0.028054591f,0.029055710f,0.030056741f,0.031057681f,0.032058528f,0.033059279f,0.034059930f,0.035060479f,0.036060922f,0.037061257f,0.038061481f,0.039061590f,0.040061582f,0.041061453f,0.042061202f,0.043060823f,0.044060316f,0.045059676f,0.046058901f,0.047057988f,0.048056933f,0.049055734f,0.050054389f,0.051052893f,0.052051244f,0.053049439f,0.054047475f,0.055045349f,0.056043058f,0.057040599f,0.058037969f,0.059035166f,0.060032186f,0.061029026f,0.062025684f,0.063022156f,0.064018440f,0.065014532f,0.066010430f,0.067006131f,0.068001632f,0.068996930f,0.069992021f,0.070986904f,0.071981575f,0.072976031f,0.073970270f,0.074964288f,0.075958083f,0.076951651f,0.077944990f,0.078938097f,0.079930969f,0.080923604f,0.081915997f,0.082908147f,0.083900051f,0.084891705f,0.085883107f,0.086874254f,0.087865143f,0.088855771f,0.089846135f,0.090836234f,0.091826063f,0.092815619f,0.093804901f,0.094793905f,0.095782629f,0.096771069f,0.097759222f,0.098747087f,0.099734660f,0.100721938f,0.101708919f,0.102695599f,0.103681977f,0.104668048f,0.105653811f,0.106639263f,0.107624401f,0.108609221f,0.109593722f,0.110577900f,0.111561754f,0.112545279f,0.113528474f,0.114511335f,0.115493860f,0.116476046f,0.117457891f,0.118439391f,0.119420544f,0.120401348f,0.121381799f,0.122361895f,0.123341633f,0.124321010f,0.125300024f,0.126278673f,0.127256953f,0.128234861f,0.129212396f,0.130189554f,0.131166333f,0.132142730f,0.133118742f,0.134094368f,0.135069603f,0.136044447f,0.137018895f,0.137992945f,0.138966596f,0.139939843f,0.140912685f,0.141885119f,0.142857143f,0.143828753f,0.144799948f,0.145770724f,0.146741079f,0.147711011f,0.148680517f,0.149649594f,0.150618240f,0.151586453f,0.152554229f,0.153521567f,0.154488464f,0.155454917f,0.156420924f,0.157386482f,0.158351589f,0.159316242f,0.160280439f,0.161244178f,0.162207455f,0.163170269f,0.164132617f,0.165094497f,0.166055906f,0.167016841f,0.167977301f,0.168937283f,0.169896784f,0.170855802f,0.171814335f,0.172772380f,0.173729935f,0.174686997f,0.175643565f,0.176599635f,0.177555206f,0.178510275f,0.179464839f,0.180418897f,0.181372446f,0.182325484f,0.183278008f,0.184230016f,0.185181505f,0.186132475f,0.187082921f,0.188032843f,0.188982237f,0.189931101f,0.190879433f,0.191827232f,0.192774493f,0.193721217f,0.194667399f,0.195613038f,0.196558132f,0.197502678f,0.198446675f,0.199390119f,0.200333010f,0.201275344f,0.202217120f,0.203158335f,0.204098987f,0.205039074f,0.205978594f,0.206917545f,0.207855924f,0.208793730f,0.209730960f,0.210667612f,0.211603685f,0.212539175f,0.213474082f,0.214408402f,0.215342135f,0.216275277f,0.217207826f,0.218139781f,0.219071140f,0.220001901f,0.220932061f,0.221861618f,0.222790571f,0.223718918f,0.224646656f,0.225573783f,0.226500298f,0.227426199f,0.228351483f,0.229276149f,0.230200195f,0.231123618f,0.232046417f,0.232968590f,0.233890135f,0.234811050f,0.235731333f,0.236650982f,0.237569996f,0.238488372f,0.239406109f,0.240323205f,0.241239658f,0.242155465f,0.243070626f,0.243985138f,0.244899000f,0.245812209f,0.246724765f,0.247636664f,0.248547906f,0.249458489f,0.250368410f,0.251277668f,0.252186262f,0.253094189f,0.254001448f,0.254908036f,0.255813953f,0.256719197f,0.257623766f,0.258527657f,0.259430870f,0.260333403f,0.261235254f,0.262136422f,0.263036904f,0.263936699f,0.264835806f,0.265734222f,0.266631947f,0.267528978f,0.268425314f,0.269320954f,0.270215895f,0.271110136f,0.272003676f,0.272896513f,0.273788646f,0.274680072f,0.275570790f,0.276460800f,0.277350098f,0.278238684f,0.279126557f,0.280013714f,0.280900154f,0.281785876f,0.282670878f,0.283555159f,0.284438717f,0.285321551f,0.286203659f,0.287085041f,0.287965693f,0.288845616f,0.289724807f,0.290603265f,0.291480990f,0.292357978f,0.293234230f,0.294109743f,0.294984517f,0.295858549f,0.296731839f,0.297604385f,0.298476186f,0.299347241f,0.300217547f,0.301087105f,0.301955912f,0.302823968f,0.303691270f,0.304557818f,0.305423611f,0.306288647f,0.307152924f,0.308016443f,0.308879200f,0.309741196f,0.310602429f,0.311462898f,0.312322601f,0.313181537f,0.314039706f,0.314897106f,0.315753735f,0.316609593f,0.317464678f,0.318318990f,0.319172527f,0.320025288f,0.320877271f,0.321728477f,0.322578903f,0.323428549f,0.324277413f,0.325125494f,0.325972792f,0.326819305f,0.327665032f,0.328509972f,0.329354124f,0.330197487f,0.331040060f,0.331881842f,0.332722832f,0.333563029f,0.334402432f,0.335241039f,0.336078851f,0.336915865f,0.337752082f,0.338587499f,0.339422117f,0.340255933f,0.341088948f,0.341921160f,0.342752568f,0.343583172f,0.344412970f,0.345241962f,0.346070146f,0.346897522f,0.347724090f,0.348549847f,0.349374793f,0.350198928f,0.351022250f,0.351844759f,0.352666454f,0.353487333f,0.354307397f,0.355126645f,0.355945075f,0.356762686f,0.357579479f,0.358395452f,0.359210604f,0.360024935f,0.360838444f,0.361651130f,0.362462993f,0.363274031f,0.364084244f,0.364893632f,0.365702193f,0.366509927f,0.367316833f,0.368122911f,0.368928159f,0.369732578f,0.370536165f,0.371338922f,0.372140847f,0.372941940f,0.373742199f,0.374541624f,0.375340215f,0.376137972f,0.376934892f,0.377730976f,0.378526224f,0.379320634f,0.380114206f,0.380906940f,0.381698834f,0.382489889f,0.383280104f,0.384069478f,0.384858010f,0.385645701f,0.386432549f,0.387218555f,0.388003717f,0.388788036f,0.389571510f,0.390354139f,0.391135923f,0.391916861f,0.392696953f,0.393476198f,0.394254596f,0.395032146f,0.395808848f,0.396584702f,0.397359707f,0.398133863f,0.398907169f,0.399679624f,0.400451230f,0.401221984f,0.401991887f,0.402760938f,0.403529137f,0.404296484f,0.405062978f,0.405828619f,0.406593407f,0.407357340f,0.408120420f,0.408882645f,0.409644015f,0.410404530f,0.411164190f,0.411922994f,0.412680943f,0.413438035f,0.414194270f,0.414949648f,0.415704170f,0.416457834f,0.417210641f,0.417962589f,0.418713680f,0.419463912f,0.420213286f,0.420961801f,0.421709458f,0.422456254f,0.423202192f,0.423947270f,0.424691488f,0.425434847f,0.426177345f,0.426918983f,0.427659760f,0.428399677f,0.429138733f,0.429876928f,0.430614262f,0.431350735f,0.432086346f,0.432821096f,0.433554985f,0.434288012f,0.435020177f,0.435751480f,0.436481921f,0.437211500f,0.437940217f,0.438668072f,0.439395064f,0.440121195f,0.440846462f,0.441570868f,0.442294410f,0.443017091f,0.443738908f,0.444459863f,0.445179956f,0.445899185f,0.446617552f,0.447335057f,0.448051698f,0.448767477f,0.449482394f,0.450196447f,0.450909638f,0.451621967f,0.452333433f,0.453044036f,0.453753777f,0.454462655f,0.455170671f,0.455877825f,0.456584116f,0.457289546f,0.457994113f,0.458697818f,0.459400661f,0.460102642f,0.460803761f,0.461504019f,0.462203415f,0.462901950f,0.463599623f,0.464296435f,0.464992386f,0.465687476f,0.466381705f,0.467075073f,0.467767581f,0.468459229f,0.469150016f,0.469839943f,0.470529010f,0.471217218f,0.471904565f,0.472591054f,0.473276683f,0.473961453f,0.474645365f,0.475328418f,0.476010612f,0.476691948f,0.477372426f,0.478052047f,0.478730809f,0.479408715f,0.480085763f,0.480761955f,0.481437290f,0.482111768f,0.482785391f,0.483458157f,0.484130068f,0.484801124f,0.485471324f,0.486140670f,0.486809161f,0.487476798f,0.488143581f,0.488809510f,0.489474586f,0.490138809f,0.490802179f,0.491464697f,0.492126362f,0.492787176f,0.493447138f,0.494106249f,0.494764509f,0.495421919f,0.496078478f,0.496734188f,0.497389048f,0.498043059f,0.498696221f,0.499348534f,};

static const float RAY_ANGLE[RENDER_WIDTH] = {
-0.523598776f,-0.522846691f,-0.522093954f,-0.521340565f,-0.520586522f,-0.519831828f,-0.519076481f,-0.518320481f,-0.517563829f,-0.516806524f,-0.516048567f,-0.515289957f,-0.514530695f,-0.513770781f,-0.513010214f,-0.512248996f,-0.511487124f,-0.510724601f,-0.509961426f,-0.509197598f,-0.508433119f,-0.507667987f,-0.506902204f,-0.506135769f,-0.505368682f,-0.504600943f,-0.503832553f,-0.503063511f,-0.502293817f,-0.501523473f,-0.500752477f,-0.499980830f,-0.499208531f,-0.498435582f,-0.497661982f,-0.496887731f,-0.496112829f,-0.495337277f,-0.494561075f,-0.493784221f,-0.493006718f,-0.492228565f,-0.491449762f,-0.490670308f,-0.489890206f,-0.489109453f,-0.488328051f,-0.487546000f,-0.486763300f,-0.485979951f,-0.485195953f,-0.484411306f,-0.483626011f,-0.482840067f,-0.482053475f,-0.481266236f,-0.480478348f,-0.479689813f,-0.478900630f,-0.478110800f,-0.477320323f,-0.476529199f,-0.475737429f,-0.474945011f,-0.474151948f,-0.473358239f,-0.472563883f,-0.471768882f,-0.470973236f,-0.470176944f,-0.469380008f,-0.468582426f,-0.467784200f,-0.466985330f,-0.466185816f,-0.465385658f,-0.464584856f,-0.463783411f,-0.462981323f,-0.462178593f,-0.461375219f,-0.460571204f,-0.459766546f,-0.458961247f,-0.458155306f,-0.457348725f,-0.456541502f,-0.455733639f,-0.454925135f,-0.454115992f,-0.453306208f,-0.452495786f,-0.451684724f,-0.450873024f,-0.450060685f,-0.449247708f,-0.448434093f,-0.447619840f,-0.446804951f,-0.445989425f,-0.445173262f,-0.444356463f,-0.443539028f,-0.442720958f,-0.441902253f,-0.441082913f,-0.440262939f,-0.439442331f,-0.438621089f,-0.437799214f,-0.436976706f,-0.436153565f,-0.435329793f,-0.434505388f,-0.433680353f,-0.432854686f,-0.432028389f,-0.431201462f,-0.430373906f,-0.429545720f,-0.428716905f,-0.427887461f,-0.427057390f,-0.426226691f,-0.425395365f,-0.424563413f,-0.423730834f,-0.422897629f,-0.422063799f,-0.421229344f,-0.420394264f,-0.419558561f,-0.418722234f,-0.417885284f,-0.417047712f,-0.416209517f,-0.415370701f,-0.414531264f,-0.413691206f,-0.412850528f,-0.412009231f,-0.411167314f,-0.410324779f,-0.409481626f,-0.408637855f,-0.407793467f,-0.406948463f,-0.406102843f,-0.405256607f,-0.404409757f,-0.403562292f,-0.402714213f,-0.401865521f,-0.401016217f,-0.400166300f,-0.399315772f,-0.398464633f,-0.397612884f,-0.396760524f,-0.395907556f,-0.395053978f,-0.394199793f,-0.393345001f,-0.392489601f,-0.391633595f,-0.390776984f,-0.389919767f,-0.389061947f,-0.388203522f,-0.387344494f,-0.386484864f,-0.385624632f,-0.384763799f,-0.383902365f,-0.383040331f,-0.382177698f,-0.381314466f,-0.380450637f,-0.379586210f,-0.378721186f,-0.377855567f,-0.376989352f,-0.376122543f,-0.375255140f,-0.374387144f,-0.373518555f,-0.372649375f,-0.371779603f,-0.370909241f,-0.370038290f,-0.369166749f,-0.368294621f,-0.367421905f,-0.366548602f,-0.365674713f,-0.364800239f,-0.363925181f,-0.363049539f,-0.362173314f,-0.361296507f,-0.360419118f,-0.359541149f,-0.358662600f,-0.357783472f,-0.356903765f,-0.356023481f,-0.355142621f,-0.354261184f,-0.353379173f,-0.352496587f,-0.351613427f,-0.350729695f,-0.349845391f,-0.348960516f,-0.348075071f,-0.347189057f,-0.346302474f,-0.345415324f,-0.344527607f,-0.343639324f,-0.342750475f,-0.341861063f,-0.340971087f,-0.340080549f,-0.339189449f,-0.338297789f,-0.337405569f,-0.336512790f,-0.335619452f,-0.334725558f,-0.333831108f,-0.332936102f,-0.332040542f,-0.331144429f,-0.330247763f,-0.329350545f,-0.328452777f,-0.327554459f,-0.326655593f,-0.325756179f,-0.324856217f,-0.323955710f,-0.323054658f,-0.322153062f,-0.321250923f,-0.320348242f,-0.319445021f,-0.318541259f,-0.317636958f,-0.316732119f,-0.315826743f,-0.314920831f,-0.314014384f,-0.313107403f,-0.312199889f,-0.311291843f,-0.310383266f,-0.309474159f,-0.308564523f,-0.307654360f,-0.306743670f,-0.305832454f,-0.304920714f,-0.304008450f,-0.303095663f,-0.302182356f,-0.301268527f,-0.300354180f,-0.299439314f,-0.298523932f,-0.297608033f,-0.296691619f,-0.295774692f,-0.294857252f,-0.293939300f,-0.293020838f,-0.292101867f,-0.291182387f,-0.290262401f,-0.289341909f,-0.288420911f,-0.287499411f,-0.286577407f,-0.285654903f,-0.284731898f,-0.283808394f,-0.282884393f,-0.281959895f,-0.281034902f,-0.280109414f,-0.279183433f,-0.278256960f,-0.277329997f,-0.276402544f,-0.275474603f,-0.274546175f,-0.273617261f,-0.272687863f,-0.271757981f,-0.270827617f,-0.269896772f,-0.268965447f,-0.268033644f,-0.267101364f,-0.266168608f,-0.265235377f,-0.264301673f,-0.263367497f,-0.262432850f,-0.261497733f,-0.260562148f,-0.259626096f,-0.258689579f,-0.257752597f,-0.256815152f,-0.255877245f,-0.254938877f,-0.254000051f,-0.253060766f,-0.252121025f,-0.251180829f,-0.250240179f,-0.249299076f,-0.248357523f,-0.247415519f,-0.246473067f,-0.245530168f,-0.244586823f,-0.243643033f,-0.242698801f,-0.241754126f,-0.240809012f,-0.239863458f,-0.238917468f,-0.237971040f,-0.237024179f,-0.236076883f,-0.235129156f,-0.234180999f,-0.233232412f,-0.232283397f,-0.231333957f,-0.230384091f,-0.229433802f,-0.228483091f,-0.227531959f,-0.226580409f,-0.225628440f,-0.224676056f,-0.223723256f,-0.222770044f,-0.221816419f,-0.220862384f,-0.219907940f,-0.218953089f,-0.217997832f,-0.217042171f,-0.216086106f,-0.215129640f,-0.214172774f,-0.213215510f,-0.212257848f,-0.211299792f,-0.210341341f,-0.209382498f,-0.208423264f,-0.207463640f,-0.206503629f,-0.205543232f,-0.204582449f,-0.203621284f,-0.202659737f,-0.201697809f,-0.200735503f,-0.199772821f,-0.198809762f,-0.197846330f,-0.196882526f,-0.195918351f,-0.194953806f,-0.193988894f,-0.193023617f,-0.192057974f,-0.191091969f,-0.190125603f,-0.189158878f,-0.188191794f,-0.187224354f,-0.186256559f,-0.185288411f,-0.184319912f,-0.183351062f,-0.182381865f,-0.181412321f,-0.180442431f,-0.179472199f,-0.178501625f,-0.177530711f,-0.176559458f,-0.175587869f,-0.174615944f,-0.173643687f,-0.172671097f,-0.171698177f,-0.170724929f,-0.169751355f,-0.168777455f,-0.167803232f,-0.166828687f,-0.165853822f,-0.164878639f,-0.163903140f,-0.162927325f,-0.161951198f,-0.160974759f,-0.159998010f,-0.159020953f,-0.158043590f,-0.157065923f,-0.156087952f,-0.155109680f,-0.154131110f,-0.153152241f,-0.152173076f,-0.151193618f,-0.150213867f,-0.149233825f,-0.148253494f,-0.147272876f,-0.146291973f,-0.145310786f,-0.144329318f,-0.143347569f,-0.142365542f,-0.141383238f,-0.140400660f,-0.139417809f,-0.138434686f,-0.137451294f,-0.136467635f,-0.135483709f,-0.134499520f,-0.133515068f,-0.132530356f,-0.131545386f,-0.130560158f,-0.129574676f,-0.128588940f,-0.127602954f,-0.126616717f,-0.125630233f,-0.124643503f,-0.123656529f,-0.122669313f,-0.121681856f,-0.120694161f,-0.119706230f,-0.118718063f,-0.117729663f,-0.116741033f,-0.115752172f,-0.114763085f,-0.113773772f,-0.112784235f,-0.111794476f,-0.110804498f,-0.109814301f,-0.108823888f,-0.107833260f,-0.106842420f,-0.105851369f,-0.104860110f,-0.103868644f,-0.102876973f,-0.101885098f,-0.100893023f,-0.099900748f,-0.098908276f,-0.097915608f,-0.096922746f,-0.095929693f,-0.094936450f,-0.093943019f,-0.092949402f,-0.091955601f,-0.090961618f,-0.089967455f,-0.088973113f,-0.087978595f,-0.086983902f,-0.085989036f,-0.084994000f,-0.083998796f,-0.083003424f,-0.082007888f,-0.081012188f,-0.080016328f,-0.079020308f,-0.078024132f,-0.077027800f,-0.076031315f,-0.075034678f,-0.074037893f,-0.073040959f,-0.072043881f,-0.071046659f,-0.070049295f,-0.069051792f,-0.068054151f,-0.067056374f,-0.066058463f,-0.065060421f,-0.064062249f,-0.063063949f,-0.062065524f,-0.061066974f,-0.060068302f,-0.059069511f,-0.058070601f,-0.057071576f,-0.056072436f,-0.055073184f,-0.054073822f,-0.053074352f,-0.052074776f,-0.051075096f,-0.050075314f,-0.049075431f,-0.048075450f,-0.047075373f,-0.046075202f,-0.045074938f,-0.044074584f,-0.043074142f,-0.042073613f,-0.041073001f,-0.040072306f,-0.039071530f,-0.038070677f,-0.037069747f,-0.036068742f,-0.035067666f,-0.034066519f,-0.033065304f,-0.032064022f,-0.031062676f,-0.030061268f,-0.029059799f,-0.028058273f,-0.027056690f,-0.026055052f,-0.025053362f,-0.024051622f,-0.023049834f,-0.022047999f,-0.021046121f,-0.020044200f,-0.019042238f,-0.018040239f,-0.017038203f,-0.016036133f,-0.015034030f,-0.014031898f,-0.013029737f,-0.012027551f,-0.011025340f,-0.010023107f,-0.009020853f,-0.008018582f,-0.007016294f,-0.006013993f,-0.005011679f,-0.004009355f,-0.003007024f,-0.002004686f,-0.001002344f,0.000000000f,0.001002344f,0.002004686f,0.003007024f,0.004009355f,0.005011679f,0.006013993f,0.007016294f,0.008018582f,0.009020853f,0.010023107f,0.011025340f,0.012027551f,0.013029737f,0.014031898f,0.015034030f,0.016036133f,0.017038203f,0.018040239f,0.019042238f,0.020044200f,0.021046121f,0.022047999f,0.023049834f,0.024051622f,0.025053362f,0.026055052f,0.027056690f,0.028058273f,0.029059799f,0.030061268f,0.031062676f,0.032064022f,0.033065304f,0.034066519f,0.035067666f,0.036068742f,0.037069747f,0.038070677f,0.039071530f,0.040072306f,0.041073001f,0.042073613f,0.043074142f,0.044074584f,0.045074938f,0.046075202f,0.047075373f,0.048075450f,0.049075431f,0.050075314f,0.051075096f,0.052074776f,0.053074352f,0.054073822f,0.055073184f,0.056072436f,0.057071576f,0.058070601f,0.059069511f,0.060068302f,0.061066974f,0.062065524f,0.063063949f,0.064062249f,0.065060421f,0.066058463f,0.067056374f,0.068054151f,0.069051792f,0.070049295f,0.071046659f,0.072043881f,0.073040959f,0.074037893f,0.075034678f,0.076031315f,0.077027800f,0.078024132f,0.079020308f,0.080016328f,0.081012188f,0.082007888f,0.083003424f,0.083998796f,0.084994000f,0.085989036f,0.086983902f,0.087978595f,0.088973113f,0.089967455f,0.090961618f,0.091955601f,0.092949402f,0.093943019f,0.094936450f,0.095929693f,0.096922746f,0.097915608f,0.098908276f,0.099900748f,0.100893023f,0.101885098f,0.102876973f,0.103868644f,0.104860110f,0.105851369f,0.106842420f,0.107833260f,0.108823888f,0.109814301f,0.110804498f,0.111794476f,0.112784235f,0.113773772f,0.114763085f,0.115752172f,0.116741033f,0.117729663f,0.118718063f,0.119706230f,0.120694161f,0.121681856f,0.122669313f,0.123656529f,0.124643503f,0.125630233f,0.126616717f,0.127602954f,0.128588940f,0.129574676f,0.130560158f,0.131545386f,0.132530356f,0.133515068f,0.134499520f,0.135483709f,0.136467635f,0.137451294f,0.138434686f,0.139417809f,0.140400660f,0.141383238f,0.142365542f,0.143347569f,0.144329318f,0.145310786f,0.146291973f,0.147272876f,0.148253494f,0.149233825f,0.150213867f,0.151193618f,0.152173076f,0.153152241f,0.154131110f,0.155109680f,0.156087952f,0.157065923f,0.158043590f,0.159020953f,0.159998010f,0.160974759f,0.161951198f,0.162927325f,0.163903140f,0.164878639f,0.165853822f,0.166828687f,0.167803232f,0.168777455f,0.169751355f,0.170724929f,0.171698177f,0.172671097f,0.173643687f,0.174615944f,0.175587869f,0.176559458f,0.177530711f,0.178501625f,0.179472199f,0.180442431f,0.181412321f,0.182381865f,0.183351062f,0.184319912f,0.185288411f,0.186256559f,0.187224354f,0.188191794f,0.189158878f,0.190125603f,0.191091969f,0.192057974f,0.193023617f,0.193988894f,0.194953806f,0.195918351f,0.196882526f,0.197846330f,0.198809762f,0.199772821f,0.200735503f,0.201697809f,0.202659737f,0.203621284f,0.204582449f,0.205543232f,0.206503629f,0.207463640f,0.208423264f,0.209382498f,0.210341341f,0.211299792f,0.212257848f,0.213215510f,0.214172774f,0.215129640f,0.216086106f,0.217042171f,0.217997832f,0.218953089f,0.219907940f,0.220862384f,0.221816419f,0.222770044f,0.223723256f,0.224676056f,0.225628440f,0.226580409f,0.227531959f,0.228483091f,0.229433802f,0.230384091f,0.231333957f,0.232283397f,0.233232412f,0.234180999f,0.235129156f,0.236076883f,0.237024179f,0.237971040f,0.238917468f,0.239863458f,0.240809012f,0.241754126f,0.242698801f,0.243643033f,0.244586823f,0.245530168f,0.246473067f,0.247415519f,0.248357523f,0.249299076f,0.250240179f,0.251180829f,0.252121025f,0.253060766f,0.254000051f,0.254938877f,0.255877245f,0.256815152f,0.257752597f,0.258689579f,0.259626096f,0.260562148f,0.261497733f,0.262432850f,0.263367497f,0.264301673f,0.265235377f,0.266168608f,0.267101364f,0.268033644f,0.268965447f,0.269896772f,0.270827617f,0.271757981f,0.272687863f,0.273617261f,0.274546175f,0.275474603f,0.276402544f,0.277329997f,0.278256960f,0.279183433f,0.280109414f,0.281034902f,0.281959895f,0.282884393f,0.283808394f,0.284731898f,0.285654903f,0.286577407f,0.287499411f,0.288420911f,0.289341909f,0.290262401f,0.291182387f,0.292101867f,0.293020838f,0.293939300f,0.294857252f,0.295774692f,0.296691619f,0.297608033f,0.298523932f,0.299439314f,0.300354180f,0.301268527f,0.302182356f,0.303095663f,0.304008450f,0.304920714f,0.305832454f,0.306743670f,0.307654360f,0.308564523f,0.309474159f,0.310383266f,0.311291843f,0.312199889f,0.313107403f,0.314014384f,0.314920831f,0.315826743f,0.316732119f,0.317636958f,0.318541259f,0.319445021f,0.320348242f,0.321250923f,0.322153062f,0.323054658f,0.323955710f,0.324856217f,0.325756179f,0.326655593f,0.327554459f,0.328452777f,0.329350545f,0.330247763f,0.331144429f,0.332040542f,0.332936102f,0.333831108f,0.334725558f,0.335619452f,0.336512790f,0.337405569f,0.338297789f,0.339189449f,0.340080549f,0.340971087f,0.341861063f,0.342750475f,0.343639324f,0.344527607f,0.345415324f,0.346302474f,0.347189057f,0.348075071f,0.348960516f,0.349845391f,0.350729695f,0.351613427f,0.352496587f,0.353379173f,0.354261184f,0.355142621f,0.356023481f,0.356903765f,0.357783472f,0.358662600f,0.359541149f,0.360419118f,0.361296507f,0.362173314f,0.363049539f,0.363925181f,0.364800239f,0.365674713f,0.366548602f,0.367421905f,0.368294621f,0.369166749f,0.370038290f,0.370909241f,0.371779603f,0.372649375f,0.373518555f,0.374387144f,0.375255140f,0.376122543f,0.376989352f,0.377855567f,0.378721186f,0.379586210f,0.380450637f,0.381314466f,0.382177698f,0.383040331f,0.383902365f,0.384763799f,0.385624632f,0.386484864f,0.387344494f,0.388203522f,0.389061947f,0.389919767f,0.390776984f,0.391633595f,0.392489601f,0.393345001f,0.394199793f,0.395053978f,0.395907556f,0.396760524f,0.397612884f,0.398464633f,0.399315772f,0.400166300f,0.401016217f,0.401865521f,0.402714213f,0.403562292f,0.404409757f,0.405256607f,0.406102843f,0.406948463f,0.407793467f,0.408637855f,0.409481626f,0.410324779f,0.411167314f,0.412009231f,0.412850528f,0.413691206f,0.414531264f,0.415370701f,0.416209517f,0.417047712f,0.417885284f,0.418722234f,0.419558561f,0.420394264f,0.421229344f,0.422063799f,0.422897629f,0.423730834f,0.424563413f,0.425395365f,0.426226691f,0.427057390f,0.427887461f,0.428716905f,0.429545720f,0.430373906f,0.431201462f,0.432028389f,0.432854686f,0.433680353f,0.434505388f,0.435329793f,0.436153565f,0.436976706f,0.437799214f,0.438621089f,0.439442331f,0.440262939f,0.441082913f,0.441902253f,0.442720958f,0.443539028f,0.444356463f,0.445173262f,0.445989425f,0.446804951f,0.447619840f,0.448434093f,0.449247708f,0.450060685f,0.450873024f,0.451684724f,0.452495786f,0.453306208f,0.454115992f,0.454925135f,0.455733639f,0.456541502f,0.457348725f,0.458155306f,0.458961247f,0.459766546f,0.460571204f,0.461375219f,0.462178593f,0.462981323f,0.463783411f,0.464584856f,0.465385658f,0.466185816f,0.466985330f,0.467784200f,0.468582426f,0.469380008f,0.470176944f,0.470973236f,0.471768882f,0.472563883f,0.473358239f,0.474151948f,0.474945011f,0.475737429f,0.476529199f,0.477320323f,0.478110800f,0.478900630f,0.479689813f,0.480478348f,0.481266236f,0.482053475f,0.482840067f,0.483626011f,0.484411306f,0.485195953f,0.485979951f,0.486763300f,0.487546000f,0.488328051f,0.489109453f,0.489890206f,0.490670308f,0.491449762f,0.492228565f,0.493006718f,0.493784221f,0.494561075f,0.495337277f,0.496112829f,0.496887731f,0.497661982f,0.498435582f,0.499208531f,0.499980830f,0.500752477f,0.501523473f,0.502293817f,0.503063511f,0.503832553f,0.504600943f,0.505368682f,0.506135769f,0.506902204f,0.507667987f,0.508433119f,0.509197598f,0.509961426f,0.510724601f,0.511487124f,0.512248996f,0.513010214f,0.513770781f,0.514530695f,0.515289957f,0.516048567f,0.516806524f,0.517563829f,0.518320481f,0.519076481f,0.519831828f,0.520586522f,0.521340565f,0.522093954f,0.522846691f,};

static const float ROW_DIST[RENDER_HEIGHT] = {
-3.079201436f,-3.088734567f,-3.098326910f,-3.107979019f,-3.117691454f,-3.127464781f,-3.137299576f,-3.147196420f,-3.157155902f,-3.167178620f,-3.177265176f,-3.187416183f,-3.197632260f,-3.207914036f,-3.218262146f,-3.228677234f,-3.239159952f,-3.249710961f,-3.260330932f,-3.271020542f,-3.281780477f,-3.292611436f,-3.303514123f,-3.314489253f,-3.325537551f,-3.336659750f,-3.347856594f,-3.359128839f,-3.370477247f,-3.381902594f,-3.393405664f,-3.404987253f,-3.416648168f,-3.428389227f,-3.440211259f,-3.452115104f,-3.464101615f,-3.476171656f,-3.488326102f,-3.500565843f,-3.512891779f,-3.525304824f,-3.537805905f,-3.550395961f,-3.563075947f,-3.575846829f,-3.588709587f,-3.601665217f,-3.614714729f,-3.627859146f,-3.641099508f,-3.654436869f,-3.667872298f,-3.681406883f,-3.695041723f,-3.708777937f,-3.722616661f,-3.736559046f,-3.750606260f,-3.764759491f,-3.779019944f,-3.793388841f,-3.807867424f,-3.822456955f,-3.837158712f,-3.851973997f,-3.866904129f,-3.881950448f,-3.897114317f,-3.912397118f,-3.927800257f,-3.943325159f,-3.958973274f,-3.974746076f,-3.990645061f,-4.006671748f,-4.022827682f,-4.039114434f,-4.055533598f,-4.072086797f,-4.088775677f,-4.105601914f,-4.122567211f,-4.139673299f,-4.156921938f,-4.174314917f,-4.191854055f,-4.209541203f,-4.227378242f,-4.245367086f,-4.263509680f,-4.281808005f,-4.300264074f,-4.318879936f,-4.337657675f,-4.356599411f,-4.375707303f,-4.394983547f,-4.414430377f,-4.434050067f,-4.453844934f,-4.473817333f,-4.493969663f,-4.514304367f,-4.534823933f,-4.555530891f,-4.576427822f,-4.597517351f,-4.618802154f,-4.640284954f,-4.661968529f,-4.683855705f,-4.705949364f,-4.728252442f,-4.750767929f,-4.773498876f,-4.796448390f,-4.819619638f,-4.843015850f,-4.866640318f,-4.890496398f,-4.914587513f,-4.938917154f,-4.963488881f,-4.988306326f,-5.013373192f,-5.038693258f,-5.064270382f,-5.090108496f,-5.116211616f,-5.142583841f,-5.169229353f,-5.196152423f,-5.223357409f,-5.250848764f,-5.278631033f,-5.306708857f,-5.335086979f,-5.363770243f,-5.392763595f,-5.422072093f,-5.451700903f,-5.481655303f,-5.511940691f,-5.542562584f,-5.573526621f,-5.604838568f,-5.636504323f,-5.668529916f,-5.700921515f,-5.733685432f,-5.766828122f,-5.800356193f,-5.834276404f,-5.868595677f,-5.903321096f,-5.938459912f,-5.974019552f,-6.010007621f,-6.046431910f,-6.083300397f,-6.120621259f,-6.158402871f,-6.196653821f,-6.235382907f,-6.274599152f,-6.314311805f,-6.354530351f,-6.395264520f,-6.436524291f,-6.478319904f,-6.520661864f,-6.563560955f,-6.607028246f,-6.651075101f,-6.695713189f,-6.740954494f,-6.786811328f,-6.833296337f,-6.880422518f,-6.928203230f,-6.976652204f,-7.025783557f,-7.075611810f,-7.126151894f,-7.177419174f,-7.229429458f,-7.282199016f,-7.335744597f,-7.390083446f,-7.445233322f,-7.501212520f,-7.558039888f,-7.615734849f,-7.674317424f,-7.733808257f,-7.794228634f,-7.855600513f,-7.917946549f,-7.981290121f,-8.045655364f,-8.111067196f,-8.177551354f,-8.245134423f,-8.313843876f,-8.383708111f,-8.454756484f,-8.527019360f,-8.600528148f,-8.675315349f,-8.751414607f,-8.828860754f,-8.907689867f,-8.987939326f,-9.069647865f,-9.152855644f,-9.237604307f,-9.323937058f,-9.411898728f,-9.501535859f,-9.592896780f,-9.686031701f,-9.780992796f,-9.877834309f,-9.976612652f,-10.077386517f,-10.180216991f,-10.285167682f,-10.392304845f,-10.501697528f,-10.613417714f,-10.727540486f,-10.844144187f,-10.963310606f,-11.085125168f,-11.209677137f,-11.337059831f,-11.467370864f,-11.600712386f,-11.737191355f,-11.876919823f,-12.020015243f,-12.166600795f,-12.316805743f,-12.470765814f,-12.628623610f,-12.790529041f,-12.956639807f,-13.127121910f,-13.302150202f,-13.481908989f,-13.666592673f,-13.856406461f,-14.051567115f,-14.252303788f,-14.458858915f,-14.671489194f,-14.890466644f,-15.116079775f,-15.348634849f,-15.588457268f,-15.835893098f,-16.091310728f,-16.355102708f,-16.627687753f,-16.909512969f,-17.201056296f,-17.502829213f,-17.815379735f,-18.139295730f,-18.475208614f,-18.823797456f,-19.185793561f,-19.561985591f,-19.953225303f,-20.360433983f,-20.784609691f,-21.226835429f,-21.688288373f,-22.170250337f,-22.674119663f,-23.201424771f,-23.753839647f,-24.333201589f,-24.941531629f,-25.581058081f,-26.254243820f,-26.963817977f,-27.712812921f,-28.504607576f,-29.342978387f,-30.232159550f,-31.176914536f,-32.182621457f,-33.255375505f,-34.402112592f,-35.630759470f,-36.950417228f,-38.371587122f,-39.906450606f,-41.569219382f,-43.376576746f,-45.348239325f,-47.507679293f,-49.883063258f,-52.508487640f,-55.425625842f,-58.685956774f,-62.353829072f,-66.510751011f,-71.261518940f,-76.743174243f,-83.138438763f,-90.696478651f,-99.766126516f,-110.851251684f,-124.707658145f,-142.523037880f,-166.276877527f,-199.532253032f,-249.415316290f,-332.553755053f,-498.830632580f,-997.661265160f,0.0f,997.661265160f,498.830632580f,332.553755053f,249.415316290f,199.532253032f,166.276877527f,142.523037880f,124.707658145f,110.851251684f,99.766126516f,90.696478651f,83.138438763f,76.743174243f,71.261518940f,66.510751011f,62.353829072f,58.685956774f,55.425625842f,52.508487640f,49.883063258f,47.507679293f,45.348239325f,43.376576746f,41.569219382f,39.906450606f,38.371587122f,36.950417228f,35.630759470f,34.402112592f,33.255375505f,32.182621457f,31.176914536f,30.232159550f,29.342978387f,28.504607576f,27.712812921f,26.963817977f,26.254243820f,25.581058081f,24.941531629f,24.333201589f,23.753839647f,23.201424771f,22.674119663f,22.170250337f,21.688288373f,21.226835429f,20.784609691f,20.360433983f,19.953225303f,19.561985591f,19.185793561f,18.823797456f,18.475208614f,18.139295730f,17.815379735f,17.502829213f,17.201056296f,16.909512969f,16.627687753f,16.355102708f,16.091310728f,15.835893098f,15.588457268f,15.348634849f,15.116079775f,14.890466644f,14.671489194f,14.458858915f,14.252303788f,14.051567115f,13.856406461f,13.666592673f,13.481908989f,13.302150202f,13.127121910f,12.956639807f,12.790529041f,12.628623610f,12.470765814f,12.316805743f,12.166600795f,12.020015243f,11.876919823f,11.737191355f,11.600712386f,11.467370864f,11.337059831f,11.209677137f,11.085125168f,10.963310606f,10.844144187f,10.727540486f,10.613417714f,10.501697528f,10.392304845f,10.285167682f,10.180216991f,10.077386517f,9.976612652f,9.877834309f,9.780992796f,9.686031701f,9.592896780f,9.501535859f,9.411898728f,9.323937058f,9.237604307f,9.152855644f,9.069647865f,8.987939326f,8.907689867f,8.828860754f,8.751414607f,8.675315349f,8.600528148f,8.527019360f,8.454756484f,8.383708111f,8.313843876f,8.245134423f,8.177551354f,8.111067196f,8.045655364f,7.981290121f,7.917946549f,7.855600513f,7.794228634f,7.733808257f,7.674317424f,7.615734849f,7.558039888f,7.501212520f,7.445233322f,7.390083446f,7.335744597f,7.282199016f,7.229429458f,7.177419174f,7.126151894f,7.075611810f,7.025783557f,6.976652204f,6.928203230f,6.880422518f,6.833296337f,6.786811328f,6.740954494f,6.695713189f,6.651075101f,6.607028246f,6.563560955f,6.520661864f,6.478319904f,6.436524291f,6.395264520f,6.354530351f,6.314311805f,6.274599152f,6.235382907f,6.196653821f,6.158402871f,6.120621259f,6.083300397f,6.046431910f,6.010007621f,5.974019552f,5.938459912f,5.903321096f,5.868595677f,5.834276404f,5.800356193f,5.766828122f,5.733685432f,5.700921515f,5.668529916f,5.636504323f,5.604838568f,5.573526621f,5.542562584f,5.511940691f,5.481655303f,5.451700903f,5.422072093f,5.392763595f,5.363770243f,5.335086979f,5.306708857f,5.278631033f,5.250848764f,5.223357409f,5.196152423f,5.169229353f,5.142583841f,5.116211616f,5.090108496f,5.064270382f,5.038693258f,5.013373192f,4.988306326f,4.963488881f,4.938917154f,4.914587513f,4.890496398f,4.866640318f,4.843015850f,4.819619638f,4.796448390f,4.773498876f,4.750767929f,4.728252442f,4.705949364f,4.683855705f,4.661968529f,4.640284954f,4.618802154f,4.597517351f,4.576427822f,4.555530891f,4.534823933f,4.514304367f,4.493969663f,4.473817333f,4.453844934f,4.434050067f,4.414430377f,4.394983547f,4.375707303f,4.356599411f,4.337657675f,4.318879936f,4.300264074f,4.281808005f,4.263509680f,4.245367086f,4.227378242f,4.209541203f,4.191854055f,4.174314917f,4.156921938f,4.139673299f,4.122567211f,4.105601914f,4.088775677f,4.072086797f,4.055533598f,4.039114434f,4.022827682f,4.006671748f,3.990645061f,3.974746076f,3.958973274f,3.943325159f,3.927800257f,3.912397118f,3.897114317f,3.881950448f,3.866904129f,3.851973997f,3.837158712f,3.822456955f,3.807867424f,3.793388841f,3.779019944f,3.764759491f,3.750606260f,3.736559046f,3.722616661f,3.708777937f,3.695041723f,3.681406883f,3.667872298f,3.654436869f,3.641099508f,3.627859146f,3.614714729f,3.601665217f,3.588709587f,3.575846829f,3.563075947f,3.550395961f,3.537805905f,3.525304824f,3.512891779f,3.500565843f,3.488326102f,3.476171656f,3.464101615f,3.452115104f,3.440211259f,3.428389227f,3.416648168f,3.404987253f,3.393405664f,3.381902594f,3.370477247f,3.359128839f,3.347856594f,3.336659750f,3.325537551f,3.314489253f,3.303514123f,3.292611436f,3.281780477f,3.271020542f,3.260330932f,3.249710961f,3.239159952f,3.228677234f,3.218262146f,3.207914036f,3.197632260f,3.187416183f,3.177265176f,3.167178620f,3.157155902f,3.147196420f,3.137299576f,3.127464781f,3.117691454f,3.107979019f,3.098326910f,3.088734567f,};  

static const float FLOOR_RAY_X[RENDER_WIDTH] = {
-0.500000000f,-0.499348534f,-0.498696221f,-0.498043059f,-0.497389048f,-0.496734188f,-0.496078478f,-0.495421919f,-0.494764509f,-0.494106249f,-0.493447138f,-0.492787176f,-0.492126362f,-0.491464697f,-0.490802179f,-0.490138809f,-0.489474586f,-0.488809510f,-0.488143581f,-0.487476798f,-0.486809161f,-0.486140670f,-0.485471324f,-0.484801124f,-0.484130068f,-0.483458157f,-0.482785391f,-0.482111768f,-0.481437290f,-0.480761955f,-0.480085763f,-0.479408715f,-0.478730809f,-0.478052047f,-0.477372426f,-0.476691948f,-0.476010612f,-0.475328418f,-0.474645365f,-0.473961453f,-0.473276683f,-0.472591054f,-0.471904565f,-0.471217218f,-0.470529010f,-0.469839943f,-0.469150016f,-0.468459229f,-0.467767581f,-0.467075073f,-0.466381705f,-0.465687476f,-0.464992386f,-0.464296435f,-0.463599623f,-0.462901950f,-0.462203415f,-0.461504019f,-0.460803761f,-0.460102642f,-0.459400661f,-0.458697818f,-0.457994113f,-0.457289546f,-0.456584116f,-0.455877825f,-0.455170671f,-0.454462655f,-0.453753777f,-0.453044036f,-0.452333433f,-0.451621967f,-0.450909638f,-0.450196447f,-0.449482394f,-0.448767477f,-0.448051698f,-0.447335057f,-0.446617552f,-0.445899185f,-0.445179956f,-0.444459863f,-0.443738908f,-0.443017091f,-0.442294410f,-0.441570868f,-0.440846462f,-0.440121195f,-0.439395064f,-0.438668072f,-0.437940217f,-0.437211500f,-0.436481921f,-0.435751480f,-0.435020177f,-0.434288012f,-0.433554985f,-0.432821096f,-0.432086346f,-0.431350735f,-0.430614262f,-0.429876928f,-0.429138733f,-0.428399677f,-0.427659760f,-0.426918983f,-0.426177345f,-0.425434847f,-0.424691488f,-0.423947270f,-0.423202192f,-0.422456254f,-0.421709458f,-0.420961801f,-0.420213286f,-0.419463912f,-0.418713680f,-0.417962589f,-0.417210641f,-0.416457834f,-0.415704170f,-0.414949648f,-0.414194270f,-0.413438035f,-0.412680943f,-0.411922994f,-0.411164190f,-0.410404530f,-0.409644015f,-0.408882645f,-0.408120420f,-0.407357340f,-0.406593407f,-0.405828619f,-0.405062978f,-0.404296484f,-0.403529137f,-0.402760938f,-0.401991887f,-0.401221984f,-0.400451230f,-0.399679624f,-0.398907169f,-0.398133863f,-0.397359707f,-0.396584702f,-0.395808848f,-0.395032146f,-0.394254596f,-0.393476198f,-0.392696953f,-0.391916861f,-0.391135923f,-0.390354139f,-0.389571510f,-0.388788036f,-0.388003717f,-0.387218555f,-0.386432549f,-0.385645701f,-0.384858010f,-0.384069478f,-0.383280104f,-0.382489889f,-0.381698834f,-0.380906940f,-0.380114206f,-0.379320634f,-0.378526224f,-0.377730976f,-0.376934892f,-0.376137972f,-0.375340215f,-0.374541624f,-0.373742199f,-0.372941940f,-0.372140847f,-0.371338922f,-0.370536165f,-0.369732578f,-0.368928159f,-0.368122911f,-0.367316833f,-0.366509927f,-0.365702193f,-0.364893632f,-0.364084244f,-0.363274031f,-0.362462993f,-0.361651130f,-0.360838444f,-0.360024935f,-0.359210604f,-0.358395452f,-0.357579479f,-0.356762686f,-0.355945075f,-0.355126645f,-0.354307397f,-0.353487333f,-0.352666454f,-0.351844759f,-0.351022250f,-0.350198928f,-0.349374793f,-0.348549847f,-0.347724090f,-0.346897522f,-0.346070146f,-0.345241962f,-0.344412970f,-0.343583172f,-0.342752568f,-0.341921160f,-0.341088948f,-0.340255933f,-0.339422117f,-0.338587499f,-0.337752082f,-0.336915865f,-0.336078851f,-0.335241039f,-0.334402432f,-0.333563029f,-0.332722832f,-0.331881842f,-0.331040060f,-0.330197487f,-0.329354124f,-0.328509972f,-0.327665032f,-0.326819305f,-0.325972792f,-0.325125494f,-0.324277413f,-0.323428549f,-0.322578903f,-0.321728477f,-0.320877271f,-0.320025288f,-0.319172527f,-0.318318990f,-0.317464678f,-0.316609593f,-0.315753735f,-0.314897106f,-0.314039706f,-0.313181537f,-0.312322601f,-0.311462898f,-0.310602429f,-0.309741196f,-0.308879200f,-0.308016443f,-0.307152924f,-0.306288647f,-0.305423611f,-0.304557818f,-0.303691270f,-0.302823968f,-0.301955912f,-0.301087105f,-0.300217547f,-0.299347241f,-0.298476186f,-0.297604385f,-0.296731839f,-0.295858549f,-0.294984517f,-0.294109743f,-0.293234230f,-0.292357978f,-0.291480990f,-0.290603265f,-0.289724807f,-0.288845616f,-0.287965693f,-0.287085041f,-0.286203659f,-0.285321551f,-0.284438717f,-0.283555159f,-0.282670878f,-0.281785876f,-0.280900154f,-0.280013714f,-0.279126557f,-0.278238684f,-0.277350098f,-0.276460800f,-0.275570790f,-0.274680072f,-0.273788646f,-0.272896513f,-0.272003676f,-0.271110136f,-0.270215895f,-0.269320954f,-0.268425314f,-0.267528978f,-0.266631947f,-0.265734222f,-0.264835806f,-0.263936699f,-0.263036904f,-0.262136422f,-0.261235254f,-0.260333403f,-0.259430870f,-0.258527657f,-0.257623766f,-0.256719197f,-0.255813953f,-0.254908036f,-0.254001448f,-0.253094189f,-0.252186262f,-0.251277668f,-0.250368410f,-0.249458489f,-0.248547906f,-0.247636664f,-0.246724765f,-0.245812209f,-0.244899000f,-0.243985138f,-0.243070626f,-0.242155465f,-0.241239658f,-0.240323205f,-0.239406109f,-0.238488372f,-0.237569996f,-0.236650982f,-0.235731333f,-0.234811050f,-0.233890135f,-0.232968590f,-0.232046417f,-0.231123618f,-0.230200195f,-0.229276149f,-0.228351483f,-0.227426199f,-0.226500298f,-0.225573783f,-0.224646656f,-0.223718918f,-0.222790571f,-0.221861618f,-0.220932061f,-0.220001901f,-0.219071140f,-0.218139781f,-0.217207826f,-0.216275277f,-0.215342135f,-0.214408402f,-0.213474082f,-0.212539175f,-0.211603685f,-0.210667612f,-0.209730960f,-0.208793730f,-0.207855924f,-0.206917545f,-0.205978594f,-0.205039074f,-0.204098987f,-0.203158335f,-0.202217120f,-0.201275344f,-0.200333010f,-0.199390119f,-0.198446675f,-0.197502678f,-0.196558132f,-0.195613038f,-0.194667399f,-0.193721217f,-0.192774493f,-0.191827232f,-0.190879433f,-0.189931101f,-0.188982237f,-0.188032843f,-0.187082921f,-0.186132475f,-0.185181505f,-0.184230016f,-0.183278008f,-0.182325484f,-0.181372446f,-0.180418897f,-0.179464839f,-0.178510275f,-0.177555206f,-0.176599635f,-0.175643565f,-0.174686997f,-0.173729935f,-0.172772380f,-0.171814335f,-0.170855802f,-0.169896784f,-0.168937283f,-0.167977301f,-0.167016841f,-0.166055906f,-0.165094497f,-0.164132617f,-0.163170269f,-0.162207455f,-0.161244178f,-0.160280439f,-0.159316242f,-0.158351589f,-0.157386482f,-0.156420924f,-0.155454917f,-0.154488464f,-0.153521567f,-0.152554229f,-0.151586453f,-0.150618240f,-0.149649594f,-0.148680517f,-0.147711011f,-0.146741079f,-0.145770724f,-0.144799948f,-0.143828753f,-0.142857143f,-0.141885119f,-0.140912685f,-0.139939843f,-0.138966596f,-0.137992945f,-0.137018895f,-0.136044447f,-0.135069603f,-0.134094368f,-0.133118742f,-0.132142730f,-0.131166333f,-0.130189554f,-0.129212396f,-0.128234861f,-0.127256953f,-0.126278673f,-0.125300024f,-0.124321010f,-0.123341633f,-0.122361895f,-0.121381799f,-0.120401348f,-0.119420544f,-0.118439391f,-0.117457891f,-0.116476046f,-0.115493860f,-0.114511335f,-0.113528474f,-0.112545279f,-0.111561754f,-0.110577900f,-0.109593722f,-0.108609221f,-0.107624401f,-0.106639263f,-0.105653811f,-0.104668048f,-0.103681977f,-0.102695599f,-0.101708919f,-0.100721938f,-0.099734660f,-0.098747087f,-0.097759222f,-0.096771069f,-0.095782629f,-0.094793905f,-0.093804901f,-0.092815619f,-0.091826063f,-0.090836234f,-0.089846135f,-0.088855771f,-0.087865143f,-0.086874254f,-0.085883107f,-0.084891705f,-0.083900051f,-0.082908147f,-0.081915997f,-0.080923604f,-0.079930969f,-0.078938097f,-0.077944990f,-0.076951651f,-0.075958083f,-0.074964288f,-0.073970270f,-0.072976031f,-0.071981575f,-0.070986904f,-0.069992021f,-0.068996930f,-0.068001632f,-0.067006131f,-0.066010430f,-0.065014532f,-0.064018440f,-0.063022156f,-0.062025684f,-0.061029026f,-0.060032186f,-0.059035166f,-0.058037969f,-0.057040599f,-0.056043058f,-0.055045349f,-0.054047475f,-0.053049439f,-0.052051244f,-0.051052893f,-0.050054389f,-0.049055734f,-0.048056933f,-0.047057988f,-0.046058901f,-0.045059676f,-0.044060316f,-0.043060823f,-0.042061202f,-0.041061453f,-0.040061582f,-0.039061590f,-0.038061481f,-0.037061257f,-0.036060922f,-0.035060479f,-0.034059930f,-0.033059279f,-0.032058528f,-0.031057681f,-0.030056741f,-0.029055710f,-0.028054591f,-0.027053388f,-0.026052104f,-0.025050742f,-0.024049304f,-0.023047793f,-0.022046213f,-0.021044567f,-0.020042857f,-0.019041087f,-0.018039260f,-0.017037378f,-0.016035445f,-0.015033464f,-0.014031438f,-0.013029369f,-0.012027261f,-0.011025116f,-0.010022939f,-0.009020731f,-0.008018496f,-0.007016237f,-0.006013957f,-0.005011658f,-0.004009345f,-0.003007019f,-0.002004684f,-0.001002344f,0.000000000f,0.001002344f,0.002004684f,0.003007019f,0.004009345f,0.005011658f,0.006013957f,0.007016237f,0.008018496f,0.009020731f,0.010022939f,0.011025116f,0.012027261f,0.013029369f,0.014031438f,0.015033464f,0.016035445f,0.017037378f,0.018039260f,0.019041087f,0.020042857f,0.021044567f,0.022046213f,0.023047793f,0.024049304f,0.025050742f,0.026052104f,0.027053388f,0.028054591f,0.029055710f,0.030056741f,0.031057681f,0.032058528f,0.033059279f,0.034059930f,0.035060479f,0.036060922f,0.037061257f,0.038061481f,0.039061590f,0.040061582f,0.041061453f,0.042061202f,0.043060823f,0.044060316f,0.045059676f,0.046058901f,0.047057988f,0.048056933f,0.049055734f,0.050054389f,0.051052893f,0.052051244f,0.053049439f,0.054047475f,0.055045349f,0.056043058f,0.057040599f,0.058037969f,0.059035166f,0.060032186f,0.061029026f,0.062025684f,0.063022156f,0.064018440f,0.065014532f,0.066010430f,0.067006131f,0.068001632f,0.068996930f,0.069992021f,0.070986904f,0.071981575f,0.072976031f,0.073970270f,0.074964288f,0.075958083f,0.076951651f,0.077944990f,0.078938097f,0.079930969f,0.080923604f,0.081915997f,0.082908147f,0.083900051f,0.084891705f,0.085883107f,0.086874254f,0.087865143f,0.088855771f,0.089846135f,0.090836234f,0.091826063f,0.092815619f,0.093804901f,0.094793905f,0.095782629f,0.096771069f,0.097759222f,0.098747087f,0.099734660f,0.100721938f,0.101708919f,0.102695599f,0.103681977f,0.104668048f,0.105653811f,0.106639263f,0.107624401f,0.108609221f,0.109593722f,0.110577900f,0.111561754f,0.112545279f,0.113528474f,0.114511335f,0.115493860f,0.116476046f,0.117457891f,0.118439391f,0.119420544f,0.120401348f,0.121381799f,0.122361895f,0.123341633f,0.124321010f,0.125300024f,0.126278673f,0.127256953f,0.128234861f,0.129212396f,0.130189554f,0.131166333f,0.132142730f,0.133118742f,0.134094368f,0.135069603f,0.136044447f,0.137018895f,0.137992945f,0.138966596f,0.139939843f,0.140912685f,0.141885119f,0.142857143f,0.143828753f,0.144799948f,0.145770724f,0.146741079f,0.147711011f,0.148680517f,0.149649594f,0.150618240f,0.151586453f,0.152554229f,0.153521567f,0.154488464f,0.155454917f,0.156420924f,0.157386482f,0.158351589f,0.159316242f,0.160280439f,0.161244178f,0.162207455f,0.163170269f,0.164132617f,0.165094497f,0.166055906f,0.167016841f,0.167977301f,0.168937283f,0.169896784f,0.170855802f,0.171814335f,0.172772380f,0.173729935f,0.174686997f,0.175643565f,0.176599635f,0.177555206f,0.178510275f,0.179464839f,0.180418897f,0.181372446f,0.182325484f,0.183278008f,0.184230016f,0.185181505f,0.186132475f,0.187082921f,0.188032843f,0.188982237f,0.189931101f,0.190879433f,0.191827232f,0.192774493f,0.193721217f,0.194667399f,0.195613038f,0.196558132f,0.197502678f,0.198446675f,0.199390119f,0.200333010f,0.201275344f,0.202217120f,0.203158335f,0.204098987f,0.205039074f,0.205978594f,0.206917545f,0.207855924f,0.208793730f,0.209730960f,0.210667612f,0.211603685f,0.212539175f,0.213474082f,0.214408402f,0.215342135f,0.216275277f,0.217207826f,0.218139781f,0.219071140f,0.220001901f,0.220932061f,0.221861618f,0.222790571f,0.223718918f,0.224646656f,0.225573783f,0.226500298f,0.227426199f,0.228351483f,0.229276149f,0.230200195f,0.231123618f,0.232046417f,0.232968590f,0.233890135f,0.234811050f,0.235731333f,0.236650982f,0.237569996f,0.238488372f,0.239406109f,0.240323205f,0.241239658f,0.242155465f,0.243070626f,0.243985138f,0.244899000f,0.245812209f,0.246724765f,0.247636664f,0.248547906f,0.249458489f,0.250368410f,0.251277668f,0.252186262f,0.253094189f,0.254001448f,0.254908036f,0.255813953f,0.256719197f,0.257623766f,0.258527657f,0.259430870f,0.260333403f,0.261235254f,0.262136422f,0.263036904f,0.263936699f,0.264835806f,0.265734222f,0.266631947f,0.267528978f,0.268425314f,0.269320954f,0.270215895f,0.271110136f,0.272003676f,0.272896513f,0.273788646f,0.274680072f,0.275570790f,0.276460800f,0.277350098f,0.278238684f,0.279126557f,0.280013714f,0.280900154f,0.281785876f,0.282670878f,0.283555159f,0.284438717f,0.285321551f,0.286203659f,0.287085041f,0.287965693f,0.288845616f,0.289724807f,0.290603265f,0.291480990f,0.292357978f,0.293234230f,0.294109743f,0.294984517f,0.295858549f,0.296731839f,0.297604385f,0.298476186f,0.299347241f,0.300217547f,0.301087105f,0.301955912f,0.302823968f,0.303691270f,0.304557818f,0.305423611f,0.306288647f,0.307152924f,0.308016443f,0.308879200f,0.309741196f,0.310602429f,0.311462898f,0.312322601f,0.313181537f,0.314039706f,0.314897106f,0.315753735f,0.316609593f,0.317464678f,0.318318990f,0.319172527f,0.320025288f,0.320877271f,0.321728477f,0.322578903f,0.323428549f,0.324277413f,0.325125494f,0.325972792f,0.326819305f,0.327665032f,0.328509972f,0.329354124f,0.330197487f,0.331040060f,0.331881842f,0.332722832f,0.333563029f,0.334402432f,0.335241039f,0.336078851f,0.336915865f,0.337752082f,0.338587499f,0.339422117f,0.340255933f,0.341088948f,0.341921160f,0.342752568f,0.343583172f,0.344412970f,0.345241962f,0.346070146f,0.346897522f,0.347724090f,0.348549847f,0.349374793f,0.350198928f,0.351022250f,0.351844759f,0.352666454f,0.353487333f,0.354307397f,0.355126645f,0.355945075f,0.356762686f,0.357579479f,0.358395452f,0.359210604f,0.360024935f,0.360838444f,0.361651130f,0.362462993f,0.363274031f,0.364084244f,0.364893632f,0.365702193f,0.366509927f,0.367316833f,0.368122911f,0.368928159f,0.369732578f,0.370536165f,0.371338922f,0.372140847f,0.372941940f,0.373742199f,0.374541624f,0.375340215f,0.376137972f,0.376934892f,0.377730976f,0.378526224f,0.379320634f,0.380114206f,0.380906940f,0.381698834f,0.382489889f,0.383280104f,0.384069478f,0.384858010f,0.385645701f,0.386432549f,0.387218555f,0.388003717f,0.388788036f,0.389571510f,0.390354139f,0.391135923f,0.391916861f,0.392696953f,0.393476198f,0.394254596f,0.395032146f,0.395808848f,0.396584702f,0.397359707f,0.398133863f,0.398907169f,0.399679624f,0.400451230f,0.401221984f,0.401991887f,0.402760938f,0.403529137f,0.404296484f,0.405062978f,0.405828619f,0.406593407f,0.407357340f,0.408120420f,0.408882645f,0.409644015f,0.410404530f,0.411164190f,0.411922994f,0.412680943f,0.413438035f,0.414194270f,0.414949648f,0.415704170f,0.416457834f,0.417210641f,0.417962589f,0.418713680f,0.419463912f,0.420213286f,0.420961801f,0.421709458f,0.422456254f,0.423202192f,0.423947270f,0.424691488f,0.425434847f,0.426177345f,0.426918983f,0.427659760f,0.428399677f,0.429138733f,0.429876928f,0.430614262f,0.431350735f,0.432086346f,0.432821096f,0.433554985f,0.434288012f,0.435020177f,0.435751480f,0.436481921f,0.437211500f,0.437940217f,0.438668072f,0.439395064f,0.440121195f,0.440846462f,0.441570868f,0.442294410f,0.443017091f,0.443738908f,0.444459863f,0.445179956f,0.445899185f,0.446617552f,0.447335057f,0.448051698f,0.448767477f,0.449482394f,0.450196447f,0.450909638f,0.451621967f,0.452333433f,0.453044036f,0.453753777f,0.454462655f,0.455170671f,0.455877825f,0.456584116f,0.457289546f,0.457994113f,0.458697818f,0.459400661f,0.460102642f,0.460803761f,0.461504019f,0.462203415f,0.462901950f,0.463599623f,0.464296435f,0.464992386f,0.465687476f,0.466381705f,0.467075073f,0.467767581f,0.468459229f,0.469150016f,0.469839943f,0.470529010f,0.471217218f,0.471904565f,0.472591054f,0.473276683f,0.473961453f,0.474645365f,0.475328418f,0.476010612f,0.476691948f,0.477372426f,0.478052047f,0.478730809f,0.479408715f,0.480085763f,0.480761955f,0.481437290f,0.482111768f,0.482785391f,0.483458157f,0.484130068f,0.484801124f,0.485471324f,0.486140670f,0.486809161f,0.487476798f,0.488143581f,0.488809510f,0.489474586f,0.490138809f,0.490802179f,0.491464697f,0.492126362f,0.492787176f,0.493447138f,0.494106249f,0.494764509f,0.495421919f,0.496078478f,0.496734188f,0.497389048f,0.498043059f,0.498696221f,0.499348534f,};

static const float FLOOR_RAY_Y[RENDER_WIDTH] = {
0.866025404f,0.866401201f,0.866776834f,0.867152300f,0.867527599f,0.867902729f,0.868277688f,0.868652475f,0.869027088f,0.869401527f,0.869775788f,0.870149872f,0.870523775f,0.870897498f,0.871271038f,0.871644393f,0.872017563f,0.872390545f,0.872763338f,0.873135941f,0.873508352f,0.873880569f,0.874252591f,0.874624417f,0.874996044f,0.875367472f,0.875738698f,0.876109721f,0.876480539f,0.876851152f,0.877221557f,0.877591752f,0.877961737f,0.878331510f,0.878701068f,0.879070410f,0.879439536f,0.879808442f,0.880177129f,0.880545593f,0.880913833f,0.881281848f,0.881649636f,0.882017196f,0.882384525f,0.882751623f,0.883118487f,0.883485117f,0.883851509f,0.884217663f,0.884583577f,0.884949250f,0.885314679f,0.885679863f,0.886044801f,0.886409491f,0.886773930f,0.887138118f,0.887502053f,0.887865733f,0.888229156f,0.888592321f,0.888955225f,0.889317869f,0.889680249f,0.890042363f,0.890404212f,0.890765791f,0.891127101f,0.891488139f,0.891848903f,0.892209392f,0.892569604f,0.892929537f,0.893289190f,0.893648561f,0.894007649f,0.894366450f,0.894724964f,0.895083190f,0.895441124f,0.895798766f,0.896156114f,0.896513166f,0.896869921f,0.897226376f,0.897582529f,0.897938380f,0.898293926f,0.898649166f,0.899004097f,0.899358718f,0.899713028f,0.900067024f,0.900420705f,0.900774069f,0.901127114f,0.901479838f,0.901832240f,0.902184318f,0.902536070f,0.902887494f,0.903238589f,0.903589352f,0.903939782f,0.904289877f,0.904639636f,0.904989056f,0.905338136f,0.905686873f,0.906035267f,0.906383315f,0.906731015f,0.907078366f,0.907425366f,0.907772012f,0.908118304f,0.908464239f,0.908809816f,0.909155032f,0.909499886f,0.909844376f,0.910188501f,0.910532257f,0.910875644f,0.911218660f,0.911561303f,0.911903570f,0.912245461f,0.912586973f,0.912928104f,0.913268853f,0.913609217f,0.913949195f,0.914288786f,0.914627986f,0.914966795f,0.915305210f,0.915643229f,0.915980851f,0.916318074f,0.916654896f,0.916991314f,0.917327328f,0.917662935f,0.917998134f,0.918332922f,0.918667298f,0.919001259f,0.919334804f,0.919667931f,0.920000638f,0.920332923f,0.920664785f,0.920996221f,0.921327229f,0.921657808f,0.921987956f,0.922317670f,0.922646949f,0.922975792f,0.923304195f,0.923632157f,0.923959677f,0.924286752f,0.924613380f,0.924939560f,0.925265290f,0.925590567f,0.925915390f,0.926239757f,0.926563666f,0.926887114f,0.927210101f,0.927532624f,0.927854681f,0.928176271f,0.928497391f,0.928818039f,0.929138214f,0.929457914f,0.929777136f,0.930095879f,0.930414141f,0.930731920f,0.931049213f,0.931366020f,0.931682338f,0.931998165f,0.932313499f,0.932628338f,0.932942681f,0.933256525f,0.933569869f,0.933882710f,0.934195047f,0.934506877f,0.934818200f,0.935129011f,0.935439311f,0.935749097f,0.936058367f,0.936367118f,0.936675350f,0.936983060f,0.937290246f,0.937596906f,0.937903038f,0.938208641f,0.938513712f,0.938818250f,0.939122252f,0.939425717f,0.939728642f,0.940031026f,0.940332867f,0.940634162f,0.940934910f,0.941235109f,0.941534758f,0.941833853f,0.942132393f,0.942430376f,0.942727800f,0.943024664f,0.943320965f,0.943616701f,0.943911871f,0.944206472f,0.944500502f,0.944793960f,0.945086844f,0.945379151f,0.945670880f,0.945962029f,0.946252595f,0.946542578f,0.946831974f,0.947120783f,0.947409001f,0.947696628f,0.947983661f,0.948270098f,0.948555937f,0.948841177f,0.949125815f,0.949409850f,0.949693279f,0.949976101f,0.950258314f,0.950539916f,0.950820904f,0.951101277f,0.951381034f,0.951660171f,0.951938688f,0.952216581f,0.952493851f,0.952770493f,0.953046507f,0.953321891f,0.953596642f,0.953870759f,0.954144239f,0.954417082f,0.954689284f,0.954960845f,0.955231762f,0.955502033f,0.955771656f,0.956040630f,0.956308952f,0.956576621f,0.956843635f,0.957109992f,0.957375689f,0.957640726f,0.957905099f,0.958168808f,0.958431851f,0.958694225f,0.958955928f,0.959216959f,0.959477316f,0.959736997f,0.959996000f,0.960254323f,0.960511965f,0.960768923f,0.961025195f,0.961280781f,0.961535677f,0.961789882f,0.962043395f,0.962296212f,0.962548333f,0.962799756f,0.963050478f,0.963300499f,0.963549815f,0.963798425f,0.964046328f,0.964293522f,0.964540004f,0.964785773f,0.965030827f,0.965275164f,0.965518782f,0.965761680f,0.966003856f,0.966245308f,0.966486034f,0.966726032f,0.966965301f,0.967203838f,0.967441642f,0.967678712f,0.967915045f,0.968150639f,0.968385493f,0.968619605f,0.968852973f,0.969085595f,0.969317470f,0.969548596f,0.969778971f,0.970008593f,0.970237461f,0.970465573f,0.970692926f,0.970919520f,0.971145353f,0.971370422f,0.971594726f,0.971818264f,0.972041034f,0.972263033f,0.972484260f,0.972704714f,0.972924392f,0.973143294f,0.973361417f,0.973578759f,0.973795319f,0.974011096f,0.974226087f,0.974440291f,0.974653706f,0.974866330f,0.975078162f,0.975289200f,0.975499443f,0.975708889f,0.975917535f,0.976125381f,0.976332425f,0.976538665f,0.976744100f,0.976948728f,0.977152546f,0.977355555f,0.977557751f,0.977759134f,0.977959702f,0.978159453f,0.978358385f,0.978556498f,0.978753788f,0.978950256f,0.979145899f,0.979340715f,0.979534704f,0.979727863f,0.979920191f,0.980111686f,0.980302347f,0.980492173f,0.980681161f,0.980869310f,0.981056619f,0.981243086f,0.981428710f,0.981613489f,0.981797422f,0.981980506f,0.982162741f,0.982344125f,0.982524657f,0.982704335f,0.982883158f,0.983061123f,0.983238231f,0.983414478f,0.983589864f,0.983764388f,0.983938048f,0.984110842f,0.984282769f,0.984453827f,0.984624016f,0.984793333f,0.984961778f,0.985129349f,0.985296044f,0.985461863f,0.985626803f,0.985790863f,0.985954043f,0.986116340f,0.986277753f,0.986438282f,0.986597924f,0.986756678f,0.986914543f,0.987071518f,0.987227600f,0.987382790f,0.987537086f,0.987690485f,0.987842988f,0.987994592f,0.988145297f,0.988295101f,0.988444003f,0.988592002f,0.988739096f,0.988885283f,0.989030564f,0.989174937f,0.989318400f,0.989460952f,0.989602592f,0.989743319f,0.989883131f,0.990022028f,0.990160007f,0.990297069f,0.990433212f,0.990568434f,0.990702735f,0.990836113f,0.990968567f,0.991100096f,0.991230699f,0.991360375f,0.991489123f,0.991616941f,0.991743828f,0.991869784f,0.991994807f,0.992118896f,0.992242050f,0.992364269f,0.992485550f,0.992605893f,0.992725297f,0.992843761f,0.992961284f,0.993077864f,0.993193501f,0.993308194f,0.993421942f,0.993534743f,0.993646597f,0.993757503f,0.993867460f,0.993976467f,0.994084522f,0.994191626f,0.994297776f,0.994402973f,0.994507214f,0.994610501f,0.994712830f,0.994814202f,0.994914615f,0.995014069f,0.995112563f,0.995210096f,0.995306666f,0.995402274f,0.995496919f,0.995590599f,0.995683314f,0.995775062f,0.995865844f,0.995955658f,0.996044503f,0.996132379f,0.996219285f,0.996305220f,0.996390184f,0.996474175f,0.996557193f,0.996639237f,0.996720307f,0.996800401f,0.996879520f,0.996957661f,0.997034826f,0.997111012f,0.997186219f,0.997260447f,0.997333695f,0.997405962f,0.997477248f,0.997547551f,0.997616872f,0.997685210f,0.997752564f,0.997818933f,0.997884317f,0.997948716f,0.998012128f,0.998074554f,0.998135992f,0.998196442f,0.998255904f,0.998314376f,0.998371860f,0.998428353f,0.998483855f,0.998538367f,0.998591887f,0.998644415f,0.998695951f,0.998746493f,0.998796043f,0.998844598f,0.998892159f,0.998938726f,0.998984297f,0.999028873f,0.999072453f,0.999115036f,0.999156623f,0.999197213f,0.999236805f,0.999275399f,0.999312996f,0.999349593f,0.999385192f,0.999419792f,0.999453393f,0.999485993f,0.999517594f,0.999548194f,0.999577794f,0.999606392f,0.999633990f,0.999660586f,0.999686181f,0.999710774f,0.999734364f,0.999756953f,0.999778539f,0.999799122f,0.999818702f,0.999837279f,0.999854853f,0.999871424f,0.999886991f,0.999901555f,0.999915114f,0.999927670f,0.999939222f,0.999949769f,0.999959312f,0.999967851f,0.999975386f,0.999981916f,0.999987442f,0.999991963f,0.999995479f,0.999997991f,0.999999498f,1.000000000f,0.999999498f,0.999997991f,0.999995479f,0.999991963f,0.999987442f,0.999981916f,0.999975386f,0.999967851f,0.999959312f,0.999949769f,0.999939222f,0.999927670f,0.999915114f,0.999901555f,0.999886991f,0.999871424f,0.999854853f,0.999837279f,0.999818702f,0.999799122f,0.999778539f,0.999756953f,0.999734364f,0.999710774f,0.999686181f,0.999660586f,0.999633990f,0.999606392f,0.999577794f,0.999548194f,0.999517594f,0.999485993f,0.999453393f,0.999419792f,0.999385192f,0.999349593f,0.999312996f,0.999275399f,0.999236805f,0.999197213f,0.999156623f,0.999115036f,0.999072453f,0.999028873f,0.998984297f,0.998938726f,0.998892159f,0.998844598f,0.998796043f,0.998746493f,0.998695951f,0.998644415f,0.998591887f,0.998538367f,0.998483855f,0.998428353f,0.998371860f,0.998314376f,0.998255904f,0.998196442f,0.998135992f,0.998074554f,0.998012128f,0.997948716f,0.997884317f,0.997818933f,0.997752564f,0.997685210f,0.997616872f,0.997547551f,0.997477248f,0.997405962f,0.997333695f,0.997260447f,0.997186219f,0.997111012f,0.997034826f,0.996957661f,0.996879520f,0.996800401f,0.996720307f,0.996639237f,0.996557193f,0.996474175f,0.996390184f,0.996305220f,0.996219285f,0.996132379f,0.996044503f,0.995955658f,0.995865844f,0.995775062f,0.995683314f,0.995590599f,0.995496919f,0.995402274f,0.995306666f,0.995210096f,0.995112563f,0.995014069f,0.994914615f,0.994814202f,0.994712830f,0.994610501f,0.994507214f,0.994402973f,0.994297776f,0.994191626f,0.994084522f,0.993976467f,0.993867460f,0.993757503f,0.993646597f,0.993534743f,0.993421942f,0.993308194f,0.993193501f,0.993077864f,0.992961284f,0.992843761f,0.992725297f,0.992605893f,0.992485550f,0.992364269f,0.992242050f,0.992118896f,0.991994807f,0.991869784f,0.991743828f,0.991616941f,0.991489123f,0.991360375f,0.991230699f,0.991100096f,0.990968567f,0.990836113f,0.990702735f,0.990568434f,0.990433212f,0.990297069f,0.990160007f,0.990022028f,0.989883131f,0.989743319f,0.989602592f,0.989460952f,0.989318400f,0.989174937f,0.989030564f,0.988885283f,0.988739096f,0.988592002f,0.988444003f,0.988295101f,0.988145297f,0.987994592f,0.987842988f,0.987690485f,0.987537086f,0.987382790f,0.987227600f,0.987071518f,0.986914543f,0.986756678f,0.986597924f,0.986438282f,0.986277753f,0.986116340f,0.985954043f,0.985790863f,0.985626803f,0.985461863f,0.985296044f,0.985129349f,0.984961778f,0.984793333f,0.984624016f,0.984453827f,0.984282769f,0.984110842f,0.983938048f,0.983764388f,0.983589864f,0.983414478f,0.983238231f,0.983061123f,0.982883158f,0.982704335f,0.982524657f,0.982344125f,0.982162741f,0.981980506f,0.981797422f,0.981613489f,0.981428710f,0.981243086f,0.981056619f,0.980869310f,0.980681161f,0.980492173f,0.980302347f,0.980111686f,0.979920191f,0.979727863f,0.979534704f,0.979340715f,0.979145899f,0.978950256f,0.978753788f,0.978556498f,0.978358385f,0.978159453f,0.977959702f,0.977759134f,0.977557751f,0.977355555f,0.977152546f,0.976948728f,0.976744100f,0.976538665f,0.976332425f,0.976125381f,0.975917535f,0.975708889f,0.975499443f,0.975289200f,0.975078162f,0.974866330f,0.974653706f,0.974440291f,0.974226087f,0.974011096f,0.973795319f,0.973578759f,0.973361417f,0.973143294f,0.972924392f,0.972704714f,0.972484260f,0.972263033f,0.972041034f,0.971818264f,0.971594726f,0.971370422f,0.971145353f,0.970919520f,0.970692926f,0.970465573f,0.970237461f,0.970008593f,0.969778971f,0.969548596f,0.969317470f,0.969085595f,0.968852973f,0.968619605f,0.968385493f,0.968150639f,0.967915045f,0.967678712f,0.967441642f,0.967203838f,0.966965301f,0.966726032f,0.966486034f,0.966245308f,0.966003856f,0.965761680f,0.965518782f,0.965275164f,0.965030827f,0.964785773f,0.964540004f,0.964293522f,0.964046328f,0.963798425f,0.963549815f,0.963300499f,0.963050478f,0.962799756f,0.962548333f,0.962296212f,0.962043395f,0.961789882f,0.961535677f,0.961280781f,0.961025195f,0.960768923f,0.960511965f,0.960254323f,0.959996000f,0.959736997f,0.959477316f,0.959216959f,0.958955928f,0.958694225f,0.958431851f,0.958168808f,0.957905099f,0.957640726f,0.957375689f,0.957109992f,0.956843635f,0.956576621f,0.956308952f,0.956040630f,0.955771656f,0.955502033f,0.955231762f,0.954960845f,0.954689284f,0.954417082f,0.954144239f,0.953870759f,0.953596642f,0.953321891f,0.953046507f,0.952770493f,0.952493851f,0.952216581f,0.951938688f,0.951660171f,0.951381034f,0.951101277f,0.950820904f,0.950539916f,0.950258314f,0.949976101f,0.949693279f,0.949409850f,0.949125815f,0.948841177f,0.948555937f,0.948270098f,0.947983661f,0.947696628f,0.947409001f,0.947120783f,0.946831974f,0.946542578f,0.946252595f,0.945962029f,0.945670880f,0.945379151f,0.945086844f,0.944793960f,0.944500502f,0.944206472f,0.943911871f,0.943616701f,0.943320965f,0.943024664f,0.942727800f,0.942430376f,0.942132393f,0.941833853f,0.941534758f,0.941235109f,0.940934910f,0.940634162f,0.940332867f,0.940031026f,0.939728642f,0.939425717f,0.939122252f,0.938818250f,0.938513712f,0.938208641f,0.937903038f,0.937596906f,0.937290246f,0.936983060f,0.936675350f,0.936367118f,0.936058367f,0.935749097f,0.935439311f,0.935129011f,0.934818200f,0.934506877f,0.934195047f,0.933882710f,0.933569869f,0.933256525f,0.932942681f,0.932628338f,0.932313499f,0.931998165f,0.931682338f,0.931366020f,0.931049213f,0.930731920f,0.930414141f,0.930095879f,0.929777136f,0.929457914f,0.929138214f,0.928818039f,0.928497391f,0.928176271f,0.927854681f,0.927532624f,0.927210101f,0.926887114f,0.926563666f,0.926239757f,0.925915390f,0.925590567f,0.925265290f,0.924939560f,0.924613380f,0.924286752f,0.923959677f,0.923632157f,0.923304195f,0.922975792f,0.922646949f,0.922317670f,0.921987956f,0.921657808f,0.921327229f,0.920996221f,0.920664785f,0.920332923f,0.920000638f,0.919667931f,0.919334804f,0.919001259f,0.918667298f,0.918332922f,0.917998134f,0.917662935f,0.917327328f,0.916991314f,0.916654896f,0.916318074f,0.915980851f,0.915643229f,0.915305210f,0.914966795f,0.914627986f,0.914288786f,0.913949195f,0.913609217f,0.913268853f,0.912928104f,0.912586973f,0.912245461f,0.911903570f,0.911561303f,0.911218660f,0.910875644f,0.910532257f,0.910188501f,0.909844376f,0.909499886f,0.909155032f,0.908809816f,0.908464239f,0.908118304f,0.907772012f,0.907425366f,0.907078366f,0.906731015f,0.906383315f,0.906035267f,0.905686873f,0.905338136f,0.904989056f,0.904639636f,0.904289877f,0.903939782f,0.903589352f,0.903238589f,0.902887494f,0.902536070f,0.902184318f,0.901832240f,0.901479838f,0.901127114f,0.900774069f,0.900420705f,0.900067024f,0.899713028f,0.899358718f,0.899004097f,0.898649166f,0.898293926f,0.897938380f,0.897582529f,0.897226376f,0.896869921f,0.896513166f,0.896156114f,0.895798766f,0.895441124f,0.895083190f,0.894724964f,0.894366450f,0.894007649f,0.893648561f,0.893289190f,0.892929537f,0.892569604f,0.892209392f,0.891848903f,0.891488139f,0.891127101f,0.890765791f,0.890404212f,0.890042363f,0.889680249f,0.889317869f,0.888955225f,0.888592321f,0.888229156f,0.887865733f,0.887502053f,0.887138118f,0.886773930f,0.886409491f,0.886044801f,0.885679863f,0.885314679f,0.884949250f,0.884583577f,0.884217663f,0.883851509f,0.883485117f,0.883118487f,0.882751623f,0.882384525f,0.882017196f,0.881649636f,0.881281848f,0.880913833f,0.880545593f,0.880177129f,0.879808442f,0.879439536f,0.879070410f,0.878701068f,0.878331510f,0.877961737f,0.877591752f,0.877221557f,0.876851152f,0.876480539f,0.876109721f,0.875738698f,0.875367472f,0.874996044f,0.874624417f,0.874252591f,0.873880569f,0.873508352f,0.873135941f,0.872763338f,0.872390545f,0.872017563f,0.871644393f,0.871271038f,0.870897498f,0.870523775f,0.870149872f,0.869775788f,0.869401527f,0.869027088f,0.868652475f,0.868277688f,0.867902729f,0.867527599f,0.867152300f,0.866776834f,0.866401201f,};

DoomRaycaster::DoomRaycaster(){
    render_image.instantiate();
    render_texture.instantiate();
}

DoomRaycaster::~DoomRaycaster(){}

// methods
void DoomRaycaster::_bind_methods(){
    ClassDB::bind_method(D_METHOD("set_map", "map", "width", "height"), &DoomRaycaster::set_map);
    ClassDB::bind_method(D_METHOD("set_player_position", "position"), &DoomRaycaster::set_player_position);
    ClassDB::bind_method(D_METHOD("get_player_position"), &DoomRaycaster::get_player_position);
    ClassDB::bind_method(D_METHOD("set_player_angle", "angle"), &DoomRaycaster::set_player_angle);
    ClassDB::bind_method(D_METHOD("get_player_angle"), &DoomRaycaster::get_player_angle);
    ClassDB::bind_method(D_METHOD("set_screen_size", "width", "height"), &DoomRaycaster::set_screen_size);
    ClassDB::bind_method(D_METHOD("set_fov", "fov"), &DoomRaycaster::set_fov);
    ClassDB::bind_method(D_METHOD("set_render_distance", "distance"), &DoomRaycaster::set_render_distance);
    ClassDB::bind_method(D_METHOD("set_wall_color", "color"), &DoomRaycaster::set_wall_color);
    ClassDB::bind_method(D_METHOD("set_floor_color", "color"), &DoomRaycaster::set_floor_color);
    ClassDB::bind_method(D_METHOD("set_ceiling_color", "color"), &DoomRaycaster::set_ceiling_color);
    ClassDB::bind_method(D_METHOD("set_wall_texture", "texture"), &DoomRaycaster::set_wall_texture);
    ClassDB::bind_method(D_METHOD("set_floor_texture", "texture"), &DoomRaycaster::set_floor_texture);
    ClassDB::bind_method(D_METHOD("set_ceiling_texture", "texture"), &DoomRaycaster::set_ceiling_texture);
    ClassDB::bind_method(D_METHOD("set_key_texture", "texture"), &DoomRaycaster::set_key_texture);
    ClassDB::bind_method(D_METHOD("clear_wall_texture"), &DoomRaycaster::clear_wall_texture);
    ClassDB::bind_method(D_METHOD("clear_floor_texture"), &DoomRaycaster::clear_floor_texture);
    ClassDB::bind_method(D_METHOD("clear_ceiling_texture"), &DoomRaycaster::clear_ceiling_texture);
    ClassDB::bind_method(D_METHOD("clear_key_texture"), &DoomRaycaster::clear_key_texture);
    ClassDB::bind_method(D_METHOD("set_move_speed", "speed"), &DoomRaycaster::set_move_speed);
    ClassDB::bind_method(D_METHOD("set_rotation_speed", "speed"), &DoomRaycaster::set_rotation_speed);
    ClassDB::bind_method(D_METHOD("set_skybox_radius", "radius"), &DoomRaycaster::set_skybox_radius);
    
    ADD_SIGNAL(MethodInfo("key_collected"));
}

void DoomRaycaster::_notification(int p_what) {
    switch (p_what) {
        case NOTIFICATION_READY: {
            render_image->initialize_data(screen_width, screen_height, false, Image::FORMAT_RGB8);
            render_texture->set_image(render_image);
            set_process(true);
            print_line("DoomRaycaster: Ready - Image size: " + itos(screen_width) + "x" + itos(screen_height));
        } break;
        
        case NOTIFICATION_PROCESS: {
            double delta = get_process_delta_time();
            Input *input = Input::get_singleton();
            
            // Rotation
            if (input->is_key_pressed(Key::LEFT) || input->is_key_pressed(Key::A)){
                player_angle -= rotation_speed * delta;
            }
            if (input->is_key_pressed(Key::RIGHT) || input->is_key_pressed(Key::D)){
                player_angle += rotation_speed * delta;
            }
            
            // Movement
            Vector2 move_dir(Math::cos(player_angle), Math::sin(player_angle));
            Vector2 strafe_dir(-Math::sin(player_angle), Math::cos(player_angle));
            
            Vector2 new_pos = player_pos;
            
            if (input->is_key_pressed(Key::UP) || input->is_key_pressed(Key::W)){
                new_pos += move_dir * move_speed * delta;
            }
            if (input->is_key_pressed(Key::DOWN) || input->is_key_pressed(Key::S)){
                new_pos -= move_dir * move_speed * delta;
            }
            if (input->is_key_pressed(Key::Q)){
                new_pos -= strafe_dir * move_speed * delta;
            }
            if (input->is_key_pressed(Key::E)){
                new_pos += strafe_dir * move_speed * delta;
            }
            
            // Collision detection
            int map_x = (int)new_pos.x;
            int map_y = (int)new_pos.y;
            if (get_map_value(map_x, map_y) == 0 || get_map_value(map_x, map_y) == 2){
                player_pos = new_pos;
            }
            
            // Key collection
            map_x = (int)player_pos.x;
            map_y = (int)player_pos.y;
            if (get_map_value(map_x, map_y) == 2){
                Vector2 key_pos(map_x, map_y);
                bool already_collected = false;
                
                for(int i = 0; i < collected_keys.size(); i++){
                    if(collected_keys[i].distance_to(key_pos) < 0.1f){
                        already_collected = true;
                        break;
                    }
                }
                
                if(!already_collected){
                    collected_keys.push_back(key_pos);
                    emit_signal("key_collected");
                    print_line("DoomRaycaster: Key collected at (" + itos(map_x) + ", " + itos(map_y) + ")");
                }
            }
            
            raycast_and_render();
            queue_redraw();
        } break;
        
        case NOTIFICATION_DRAW: {
            if (render_texture.is_valid()){
                draw_texture(render_texture, Vector2(0, 0));
            }
        } break;
    }
}

inline Color fast_sample_texture(const Ref<Image>& texture, float u, float v, int tex_width, int tex_height){
    // Wrap UV coordinates using fast bitwise operations for power-of-2 textures
    u = u - Math::floor(u);
    v = v - Math::floor(v);
    
    int tex_x = (int)(u * tex_width);
    int tex_y = (int)(v * tex_height);
    
    // Fast modulo for positive numbers
    if (tex_x >= tex_width) tex_x -= tex_width;
    if (tex_y >= tex_height) tex_y -= tex_height;
    if (tex_x < 0) tex_x += tex_width;
    if (tex_y < 0) tex_y += tex_height;
    
    return texture->get_pixel(tex_x, tex_y);
}

Color DoomRaycaster::sample_texture(Ref<Image> texture, float u, float v){
    if(!texture.is_valid() || texture->is_empty()){
        return Color(1, 1, 1);
    }
    
    return fast_sample_texture(texture, u, v, texture->get_width(), texture->get_height());
}

void DoomRaycaster::render_billboard(int screen_x, float distance, Vector2 billboard_pos, Ref<Image> texture){
    if(!texture.is_valid() || texture->is_empty()){
        return;
    }
    
    if(distance < 0.1f) return;
    
    // Calculate billboard height
    float billboard_height = (screen_height / distance) * SCALE;
    int draw_start_y = MAX(0, (screen_height - billboard_height) / 2);
    int draw_end_y = MIN(screen_height - 1, (screen_height + billboard_height) / 2);
    
    // Billboard width (same as height for square billboards)
    float billboard_width = billboard_height;
    
    // Calculate screen space position
    Vector2 to_billboard = billboard_pos - player_pos;
    float angle_to_billboard = Math::atan2(to_billboard.y, to_billboard.x);
    float angle_diff = angle_to_billboard - player_angle;
    
    // Normalize angle
    while(angle_diff > Math_PI) angle_diff -= Math_TAU;
    while(angle_diff < -Math_PI) angle_diff += Math_TAU;
    
    float fov_rad = Math::deg_to_rad(fov);
    float screen_x_f = (angle_diff / fov_rad + 0.5f) * screen_width;
    int billboard_screen_x = (int)screen_x_f;
    
    // Calculate billboard width in screen space
    int half_width = (int)(billboard_width / 2);
    int start_x = billboard_screen_x - half_width;
    int end_x = billboard_screen_x + half_width;
    
    // Draw the billboard
    for(int x = start_x; x <= end_x; x++){
        if(x < 0 || x >= screen_width) continue;
        
        // Calculate texture U coordinate
        float u = (float)(x - start_x) / (float)(end_x - start_x);
        
        for(int y = draw_start_y; y <= draw_end_y; y++){
            // Calculate texture V coordinate
            float v = (float)(y - draw_start_y) / (float)(draw_end_y - draw_start_y);
            
            Color pixel = sample_texture(texture, u, v);
            
            // Simple alpha test (assuming black is transparent, or check alpha channel)
            if(pixel.a > 0.5f){
                // Apply distance fog
                float fog = 1.0f - MIN(distance / render_distance, 1.0f) * 0.6f;
                pixel = pixel * fog;
                render_image->set_pixel(x, y, pixel);
            }
        }
    }
}

void DoomRaycaster::render_skybox_cylinder(float ray_angle, int x, int ceiling_end, int sky_tex_width, int sky_tex_height) {
    // Calculate U coordinate based on angle (wraps around the cylinder)
    float u = (ray_angle + Math_PI) / Math_TAU; // Normalize angle to 0-1 range
    u = u - Math::floor(u); // Wrap
    
    int tex_x = (int)(u * sky_tex_width);
    if (tex_x >= sky_tex_width) tex_x -= sky_tex_width;
    if (tex_x < 0) tex_x += sky_tex_width;
    
    // Precompute reciprocal for faster division
    float inv_ceiling_end = 1.0f / (float)ceiling_end;
    
    // Draw vertical strip of skybox
    for(int y = 0; y < ceiling_end; y++){
        // Calculate V coordinate (top to middle of screen)
        float v = (float)y * inv_ceiling_end;
        
        int tex_y = (int)(v * sky_tex_height);
        if (tex_y >= sky_tex_height) tex_y -= sky_tex_height;
        
        Color pixel = ceiling_texture->get_pixel(tex_x, tex_y);
        render_image->set_pixel(x, y, pixel);
    }
}

void DoomRaycaster::raycast_and_render() {
    if (map_data.size() == 0 || !render_image.is_valid()) {
        return;
    }

    // Precompute FOV in radians
    float fov_rad = Math::deg_to_rad(fov);
    float tan_half_fov = Math::tan(fov_rad / 2.0f);

    // Skybox presence flag
    bool has_skybox = ceiling_texture.is_valid() && !ceiling_texture->is_empty();
    int sky_tex_width = 0;
    int sky_tex_height = 0;
    if (has_skybox) {
        sky_tex_width = ceiling_texture->get_width();
        sky_tex_height = ceiling_texture->get_height();
    }

    // Precompute player angle trig values (moved out of loop)
    float ca = Math::cos(player_angle);
    float sa = Math::sin(player_angle);

    // Precompute wall texture dimensions (moved out of loop)
    bool use_wall_texture = wall_texture.is_valid() && !wall_texture->is_empty();
    int wall_tex_width = 0;
    int wall_tex_height = 0;
    if (use_wall_texture) {
        wall_tex_width = wall_texture->get_width();
        wall_tex_height = wall_texture->get_height();
    }

    // Precompute floor texture dimensions
    bool use_floor_texture = floor_texture.is_valid() && !floor_texture->is_empty();
    int floor_tex_width = 0;
    int floor_tex_height = 0;
    if (use_floor_texture) {
        floor_tex_width = floor_texture->get_width();
        floor_tex_height = floor_texture->get_height();
    }

    // Precompute screen midpoint (moved out of loop)
    int screen_mid_height = screen_height / 2;
    
    // Precompute reciprocals for faster division
    float inv_render_distance = 1.0f / render_distance;

    // For each vertical screen column (ray)
    for (int x = 0; x < screen_width; x++) {
        // ---- 1) Compute ray direction for this column (perspective correct) ----
        // Use precomputed directions  rotated by player_angle

        // Raw lookup direction from tables
        float base_x = RAY_COS[x];
        float base_y = RAY_SIN[x];

        // Rotate lookup direction by player angle
        Vector2 ray_dir(
            base_x * ca - base_y * sa,
            base_x * sa + base_y * ca
        );

        // ---- 2) Draw skybox strip for this column (if any) ----
        if (has_skybox) {
            float ray_angle = player_angle + RAY_ANGLE[x];
            render_skybox_cylinder(ray_angle, x, screen_mid_height, sky_tex_width, sky_tex_height);
        }

        // ---- 3) Set up DDA for this ray ----
        float ray_pos_x = player_pos.x;
        float ray_pos_y = player_pos.y;

        int map_x = (int)ray_pos_x;
        int map_y = (int)ray_pos_y;

        // Length of ray to go from one x-side to next, and one y-side to next
        float delta_dist_x = (ray_dir.x == 0) ? 1e30f : Math::abs(1.0f / ray_dir.x);
        float delta_dist_y = (ray_dir.y == 0) ? 1e30f : Math::abs(1.0f / ray_dir.y);

        int step_x;
        int step_y;
        float side_dist_x;
        float side_dist_y;
        int side = 0; // 0 = hit in x, 1 = hit in y

        if (ray_dir.x < 0) {
            step_x = -1;
            side_dist_x = (ray_pos_x - map_x) * delta_dist_x;
        } else {
            step_x = 1;
            side_dist_x = (map_x + 1.0f - ray_pos_x) * delta_dist_x;
        }

        if (ray_dir.y < 0) {
            step_y = -1;
            side_dist_y = (ray_pos_y - map_y) * delta_dist_y;
        } else {
            step_y = 1;
            side_dist_y = (map_y + 1.0f - ray_pos_y) * delta_dist_y;
        }

        // ---- 4) DDA loop: march until we hit a wall or exceed render distance ----
        bool hit = false;
        float dist = render_distance; // default if we never hit
        
        // Precompute map bounds for faster checking
        const int max_steps = 100; // Safety limit
        int steps = 0;

        while (steps++ < max_steps) {
            if (side_dist_x < side_dist_y) {
                side_dist_x += delta_dist_x;
                map_x += step_x;
                side = 0;
                
                // Quick bounds check
                if (map_x < 0 || map_x >= map_width) {
                    break;
                }
            } else {
                side_dist_y += delta_dist_y;
                map_y += step_y;
                side = 1;
                
                // Quick bounds check
                if (map_y < 0 || map_y >= map_height) {
                    break;
                }
            }

            // Inline map value check for speed (avoids function call)
            int map_index = map_y * map_width + map_x;
            if (map_index >= 0 && map_index < map_data.size() && map_data[map_index] == 1) {
                hit = true;
                break;
            }

            // Early cutoff if both distances exceed render distance
            if (side_dist_x > render_distance && side_dist_y > render_distance) {
                break;
            }
        }

        if (hit) {
            // ---- 5) Compute perpendicular distance to avoid fisheye ----
            if (side == 0) {
                dist = (map_x - ray_pos_x + (1 - step_x) / 2.0f) / ray_dir.x;
            } else {
                dist = (map_y - ray_pos_y + (1 - step_y) / 2.0f) / ray_dir.y;
            }

            if (dist < 0.1f) {
                dist = 0.1f;
            }

            // ---- 6) Projected wall slice height on screen ----
            // Use reciprocal multiplication instead of division
            float inv_dist = 1.0f / dist;
            int wall_height = (int)(screen_height * inv_dist);
            int draw_start = (screen_height - wall_height) >> 1;  // Bit shift for /2
            int draw_end   = (screen_height + wall_height) >> 1;

            draw_start = MAX(0, draw_start);
            draw_end   = MIN(screen_height - 1, draw_end);

            // ---- 7) Exact wall hit position (for texture U) ----
            float wall_x;
            if (side == 0) {
                wall_x = ray_pos_y + dist * ray_dir.y;
            } else {
                wall_x = ray_pos_x + dist * ray_dir.x;
            }
            wall_x -= Math::floor(wall_x); // fractional part only (0..1)

            // ---- 8) Precompute wall texture stepping to avoid wobbling ----
            float tex_step = 0.0f;
            float tex_pos = 0.0f;
            int tex_x = 0;

            if (use_wall_texture) {
                tex_step = (float)wall_tex_height / (float)wall_height;

                // Start texture coordinate so that the center of the texture
                // aligns with the center of the projected wall column
                tex_pos = (draw_start - screen_mid_height + wall_height / 2) * tex_step;
                
                // Precompute tex_x (constant for the entire column)
                tex_x = (int)(wall_x * (float)wall_tex_width);
                if (tex_x < 0) {
                    tex_x += wall_tex_width;
                }
                tex_x %= wall_tex_width;
            }

            // ---- 9) Draw column: ceiling, wall, floor ----
            // Split into 3 separate loops for better cache coherency and branch prediction
            
            // Ceiling section (only if no skybox)
            if (!has_skybox) {
                for (int y = 0; y < draw_start; y++) {
                    render_image->set_pixel(x, y, ceiling_color);
                }
            }
            
            // Wall section
            if (use_wall_texture) {
                // Precompute fog and side shading (optimized with reciprocal)
                float fog = 1.0f - MIN(dist * inv_render_distance, 1.0f) * 0.6f;
                float side_shade = (side == 1) ? 0.7f : 1.0f;
                float combined_shade = fog * side_shade;
                
                // Unroll loop for small wall heights (common case)
                int wall_draw_height = draw_end - draw_start + 1;
                if (wall_draw_height <= 4) {
                    // Unrolled version for tiny walls
                    for (int y = draw_start; y <= draw_end; y++) {
                        int tex_y = (int)tex_pos;
                        tex_y = (tex_y < 0) ? (tex_y + wall_tex_height) : (tex_y % wall_tex_height);
                        Color pixel_color = wall_texture->get_pixel(tex_x, tex_y);
                        pixel_color = pixel_color * combined_shade;
                        tex_pos += tex_step;
                        render_image->set_pixel(x, y, pixel_color);
                    }
                } else {
                    // Standard loop for larger walls
                    for (int y = draw_start; y <= draw_end; y++) {
                        int tex_y = (int)tex_pos;
                        if (tex_y >= wall_tex_height) tex_y %= wall_tex_height;
                        else if (tex_y < 0) tex_y += wall_tex_height;
                        
                        Color pixel_color = wall_texture->get_pixel(tex_x, tex_y);
                        pixel_color = pixel_color * combined_shade;
                        tex_pos += tex_step;
                        render_image->set_pixel(x, y, pixel_color);
                    }
                }
            } else {
                // Solid color wall (optimized)
                float fog = 1.0f - MIN(dist * inv_render_distance, 1.0f) * 0.6f;
                Color shaded_wall = wall_color;
                if (side == 1) {
                    shaded_wall = shaded_wall * 0.7f;
                }
                shaded_wall = shaded_wall * fog;
                
                for (int y = draw_start; y <= draw_end; y++) {
                    render_image->set_pixel(x, y, shaded_wall);
                }
            }
            
            // Floor section (optimized with inlined texture sampling)
            if (use_floor_texture) {
                // Preload direction vectors for this column
                float dir_x = FLOOR_RAY_X[x];
                float dir_y = FLOOR_RAY_Y[x];
                
                for (int y = draw_end + 1; y < screen_height; y++) {
                    float row_dist = ROW_DIST[y];
                    Color pixel_color;
                    
                    if (row_dist > 0.0f) {
                        float world_x = player_pos.x + dir_x * row_dist;
                        float world_y = player_pos.y + dir_y * row_dist;

                        // Inline texture sampling for floor (avoids function call)
                        pixel_color = fast_sample_texture(
                            floor_texture,
                            world_x,
                            world_y,
                            floor_tex_width,
                            floor_tex_height
                        );
                    } else {
                        pixel_color = floor_color;
                    }

                    render_image->set_pixel(x, y, pixel_color);
                }
            } else {
                for (int y = draw_end + 1; y < screen_height; y++) {
                    render_image->set_pixel(x, y, floor_color);
                }
            }
        } else {
            // ---- 10) Ray did not hit a wall: draw simple ceiling/floor ----
            int start_y = has_skybox ? screen_mid_height : 0;
            
            // Ceiling section (if no skybox)
            if (!has_skybox) {
                for (int y = 0; y < screen_mid_height; y++) {
                    render_image->set_pixel(x, y, ceiling_color);
                }
            }
            
            // Floor section (optimized with inlined texture sampling)
            if (use_floor_texture) {
                float dir_x = FLOOR_RAY_X[x];
                float dir_y = FLOOR_RAY_Y[x];
                
                for (int y = start_y; y < screen_height; y++) {
                    float row_dist = ROW_DIST[y];
                    Color pixel_color;
                    
                    if (row_dist > 0.0f) {
                        float world_x = player_pos.x + dir_x * row_dist;
                        float world_y = player_pos.y + dir_y * row_dist;

                        // Inline texture sampling for floor (avoids function call)
                        pixel_color = fast_sample_texture(
                            floor_texture,
                            world_x,
                            world_y,
                            floor_tex_width,
                            floor_tex_height
                        );
                    } else {
                        pixel_color = floor_color;
                    }

                    render_image->set_pixel(x, y, pixel_color);
                }
            } else {
                for (int y = start_y; y < screen_height; y++) {
                    render_image->set_pixel(x, y, floor_color);
                }
            }
        }
    }

    // ---- 11) Render keys as billboards (unchanged) ----
    if (key_texture.is_valid() && !key_texture->is_empty()) {
        for (int y = 0; y < map_height; y++) {
            for (int x = 0; x < map_width; x++) {
                if (get_map_value(x, y) == 2) {
                    Vector2 key_pos(x + 0.5f, y + 0.5f);

                    // Check if already collected
                    bool collected = false;
                    for (int i = 0; i < collected_keys.size(); i++) {
                        if (collected_keys[i].distance_to(Vector2(x, y)) < 0.1f) {
                            collected = true;
                            break;
                        }
                    }

                    if (!collected) {
                        Vector2 to_key = key_pos - player_pos;
                        float distance = to_key.length();

                        // 1. Check if key is in front of player
                        float angle_to_key = Math::atan2(to_key.y, to_key.x);
                        float angle_diff = Math::fmod(angle_to_key - player_angle + Math_PI * 3, Math_PI * 2) - Math_PI;

                        // 2. Key must be inside FOV
                        float half_fov = Math::deg_to_rad(fov) * 0.5f;
                        if (Math::abs(angle_diff) > half_fov)
                            continue;  // SKIP  not inside FOV

                        // 3. Basic LOS: cast a tiny ray to the key and ensure no wall is directly between
                        // 3. Basic LOS check  raymarch from player to key
                        Vector2 dir = to_key.normalized();
                        float step = 0.1f;
                        float check_distance = 0.0f;

                        bool blocked = false;
                        while (check_distance < distance)
                        {
                            Vector2 p = player_pos + dir * check_distance;
                            int cx = (int)p.x;
                            int cy = (int)p.y;

                            if (get_map_value(cx, cy) == 1) {
                                blocked = true;
                                break;
                            }
                            check_distance += step;
                        }

                        if (blocked)
                            continue;  // Key is behind a wall

                        // Now render normally
                        render_billboard(0, distance, key_pos, key_texture);
                    }
                }
            }
        }
    }

    // ---- 12) Push image to texture ----
    render_texture->update(render_image);
}

int DoomRaycaster::get_map_value(int x, int y){
    if(x < 0 || y < 0 || x >= map_width || y >= map_height){
        return 1; // Out of bounds = wall
    }
    return map_data[y * map_width + x];
}

void DoomRaycaster::set_map(const Array &p_map, int p_width, int p_height){
    map_width = p_width;
    map_height = p_height;
    map_data.clear();
    collected_keys.clear();
    
    for(int i = 0; i < p_map.size(); i++){
        map_data.push_back(p_map[i]);
    }
    
    print_line("DoomRaycaster: Map set - " + itos(map_width) + "x" + itos(map_height) + " = " + itos(map_data.size()) + " cells");
}

void DoomRaycaster::set_player_position(Vector2 p_pos){
    player_pos = p_pos;
    print_line("DoomRaycaster: Player position set to (" + rtos(p_pos.x) + ", " + rtos(p_pos.y) + ")");
}

Vector2 DoomRaycaster::get_player_position() const{
    return player_pos;
}

void DoomRaycaster::set_player_angle(float p_angle){
    player_angle = p_angle;
}

float DoomRaycaster::get_player_angle() const{
    return player_angle;
}

void DoomRaycaster::set_screen_size(int p_width, int p_height){
    screen_width = p_width;
    screen_height = p_height;
    if (render_image.is_valid()) {
        render_image->initialize_data(screen_width, screen_height, false, Image::FORMAT_RGB8);
        render_texture->set_image(render_image);
    }
}

void DoomRaycaster::set_fov(float p_fov){
    fov = p_fov;
}

void DoomRaycaster::set_render_distance(float p_distance){
    render_distance = p_distance;
}

void DoomRaycaster::set_wall_color(Color p_color){
    wall_color = p_color;
}

void DoomRaycaster::set_floor_color(Color p_color){
    floor_color = p_color;
}

void DoomRaycaster::set_ceiling_color(Color p_color){
    ceiling_color = p_color;
}

void DoomRaycaster::set_wall_texture(Ref<Image> p_texture){
    wall_texture = p_texture;
    if(wall_texture.is_valid()){
        print_line("DoomRaycaster: Wall texture set - " + itos(wall_texture->get_width()) + "x" + itos(wall_texture->get_height()));
    }
}

void DoomRaycaster::set_floor_texture(Ref<Image> p_texture){
    floor_texture = p_texture;
    if(floor_texture.is_valid()){
        print_line("DoomRaycaster: Floor texture set - " + itos(floor_texture->get_width()) + "x" + itos(floor_texture->get_height()));
    }
}

void DoomRaycaster::set_ceiling_texture(Ref<Image> p_texture){
    ceiling_texture = p_texture;
    if(ceiling_texture.is_valid()){
        print_line("DoomRaycaster: Ceiling texture set (skybox cylinder) - " + itos(ceiling_texture->get_width()) + "x" + itos(ceiling_texture->get_height()));
    }
}

void DoomRaycaster::set_key_texture(Ref<Image> p_texture){
    key_texture = p_texture;
    if(key_texture.is_valid()){
        print_line("DoomRaycaster: Key texture set - " + itos(key_texture->get_width()) + "x" + itos(key_texture->get_height()));
    }
}

void DoomRaycaster::clear_wall_texture(){
    wall_texture.unref();
    print_line("DoomRaycaster: Wall texture cleared");
}

void DoomRaycaster::clear_floor_texture(){
    floor_texture.unref();
    print_line("DoomRaycaster: Floor texture cleared");
}

void DoomRaycaster::clear_ceiling_texture(){
    ceiling_texture.unref();
    print_line("DoomRaycaster: Ceiling texture cleared");
}

void DoomRaycaster::clear_key_texture(){
    key_texture.unref();
    print_line("DoomRaycaster: Key texture cleared");
}

void DoomRaycaster::set_move_speed(float p_speed){
    move_speed = p_speed;
}

void DoomRaycaster::set_rotation_speed(float p_speed){
    rotation_speed = p_speed;
}

void DoomRaycaster::set_skybox_radius(float p_radius){
    skybox_radius = p_radius;
}